\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Processing, cleaning and saving NZ GREEN Grid project 1 minute electricity power data},
            pdfauthor={Ben Anderson (b.anderson@soton.ac.uk, @dataknut)},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{longtable,booktabs}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}
  \title{Processing, cleaning and saving NZ GREEN Grid project 1 minute
electricity power data}
  \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  \author{Ben Anderson
(\href{mailto:b.anderson@soton.ac.uk}{\nolinkurl{b.anderson@soton.ac.uk}},
\texttt{@dataknut})}
  \preauthor{\centering\large\emph}
  \postauthor{\par}
  \predate{\centering\large\emph}
  \postdate{\par}
  \date{Last run at: 2018-05-09 15:31:04}


\begin{document}
\maketitle

{
\setcounter{tocdepth}{2}
\tableofcontents
}
\newpage

\section{Citation}\label{citation}

If you wish to use any of the material from this report please cite as:

\begin{itemize}
\tightlist
\item
  Anderson, B. (2018) Processing, cleaning and saving NZ GREEN Grid
  project 1 minute electricity power data, University of Otago: Dunedin,
  NZ.
\end{itemize}

\newpage

\section{Introduction}\label{introduction}

Report circulation:

\begin{itemize}
\tightlist
\item
  Restricted to:
  \href{https://www.otago.ac.nz/centre-sustainability/research/energy/otago050285.html}{NZ
  GREEN Grid} project partners and contractors.
\end{itemize}

\subsection{Purpose}\label{purpose}

This report is intended to:

\begin{itemize}
\tightlist
\item
  load and clean the project electricity power data (Grid Spy)
\item
  save the cleaned data out as a single file per household
\item
  produce summary data quality statistics
\end{itemize}

The resulting cleaned data has \emph{no} identifying information such as
names, addresses, email addresses, telephone numbers and is therefore
safe to share across all partners.

The data contains a unique household id which can be used to link it to
the NZ GREEN Grid time use diaries and dwelling/appliance surveys. With
some additional non-disclosure checks it should also be safe to archive
all of these linkable datasets for re-use via the UK
\href{http://reshare.ukdataservice.ac.uk/}{reshare} service.

\subsection{Requirements:}\label{requirements}

\begin{itemize}
\tightlist
\item
  grid spy 1 minute data downloads
\end{itemize}

\subsection{History}\label{history}

Generally tracked via our git.soton
\href{https://git.soton.ac.uk/ba1e12/nzGREENGrid}{repo}:

\begin{itemize}
\tightlist
\item
  \href{https://git.soton.ac.uk/ba1e12/nzGREENGrid/commits/master}{history}
\item
  \href{https://git.soton.ac.uk/ba1e12/nzGREENGrid/issues}{issues}
\end{itemize}

\subsection{Support}\label{support}

This work was supported by:

\begin{itemize}
\tightlist
\item
  The \href{https://www.otago.ac.nz/}{University of Otago}
\item
  The New Zealand \href{http://www.mbie.govt.nz/}{Ministry of Business,
  Innovation and Employment (MBIE)}
\item
  \href{http://www.energy.soton.ac.uk/tag/spatialec/}{SPATIALEC} - a
  \href{http://ec.europa.eu/research/mariecurieactions/about-msca/actions/if/index_en.htm}{Marie
  Skłodowska-Curie Global Fellowship} based at the University of Otago's
  \href{http://www.otago.ac.nz/centre-sustainability/staff/otago673896.html}{Centre
  for Sustainability} (2017-2019) \& the University of Southampton's
  Sustainable Energy Research Group (2019-202).
\end{itemize}

This work is (c) 2018 the University of Southampton.

We do not `support' the code but if you have a problem check the
\href{https://git.soton.ac.uk/ba1e12/nzGREENGrid/issues}{issues} on our
\href{https://git.soton.ac.uk/ba1e12/nzGREENGrid}{repo} and if it
doesn't already exist, open one. We might be able to fix it :-)

\section{Obtain listing of files}\label{obtain-listing-of-files}

In this section we generate a listing of all 1 minute data files that we
have received. If we are running over the complete dataset then we will
be using data from:

\begin{itemize}
\tightlist
\item
  /hum-csafe/Research Projects/GREEN Grid/\_RAW DATA/GridSpyData/
\end{itemize}

In this run we are using data from:

\begin{itemize}
\tightlist
\item
  /Volumes/hum-csafe/Research Projects/GREEN Grid/\_RAW
  DATA/GridSpyData/
\end{itemize}

If these do not match then this may be a test run.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Looking for 1 minute data using pattern = "}\NormalTok{, pattern1Min, }\StringTok{" in "}\NormalTok{, fpath, }\StringTok{" - could take a while..."}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Looking for 1 minute data using pattern = *at1.csv$ in /Volumes/hum-csafe/Research Projects/GREEN Grid/_RAW DATA/GridSpyData/ - could take a while..."
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{system.time}\NormalTok{(fListCompleteDT <-}\StringTok{ }\NormalTok{data.table}\OperatorTok{::}\KeywordTok{as.data.table}\NormalTok{(}\KeywordTok{list.files}\NormalTok{(}\DataTypeTok{path =}\NormalTok{ fpath, }\DataTypeTok{pattern =}\NormalTok{ pattern1Min, }\CommentTok{# use the default pattern to filter e.g. 1m from 30s files}
                                            \DataTypeTok{recursive =} \OtherTok{TRUE}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    user  system elapsed 
##   0.784   5.003 406.906
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nFiles <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(fListCompleteDT)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Found "}\NormalTok{, }\KeywordTok{tidyNum}\NormalTok{(nFiles), }\StringTok{" files"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Found 21,440 files"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(fListCompleteDT) }\OperatorTok{==}\StringTok{ }\DecValTok{0}\NormalTok{)\{}
  \KeywordTok{stop}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"No matching data files found, please check your path ("}\NormalTok{, fpath, }\StringTok{") or your search pattern ("}\NormalTok{, pattern1Min, }\StringTok{")"}\NormalTok{))}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
  \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Processing file list and getting file meta-data (please be patient)"}\NormalTok{))}
\NormalTok{  fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[, }\KeywordTok{c}\NormalTok{(}\StringTok{"hhID"}\NormalTok{,}\StringTok{"fileName"}\NormalTok{) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{data.table}\OperatorTok{::}\KeywordTok{tstrsplit}\NormalTok{(V1, }\StringTok{"/"}\NormalTok{)]}
\NormalTok{  fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[, fullPath }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{paste0}\NormalTok{(fpath, hhID,}\StringTok{"/"}\NormalTok{,fileName)]}
\NormalTok{  loopCount <-}\StringTok{ }\DecValTok{1}
  \CommentTok{# now loop over the files and collect metadata}
  \ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ fListCompleteDT[,fullPath])\{}
\NormalTok{    rf <-}\StringTok{ }\KeywordTok{path.expand}\NormalTok{(f) }\CommentTok{# just in case of ~ etc}
\NormalTok{    fsize <-}\StringTok{ }\KeywordTok{file.size}\NormalTok{(rf)}
\NormalTok{    fmtime <-}\StringTok{ }\NormalTok{lubridate}\OperatorTok{::}\KeywordTok{ymd_hms}\NormalTok{(}\KeywordTok{file.mtime}\NormalTok{(rf), }\DataTypeTok{tz =} \StringTok{"Pacific/Auckland"}\NormalTok{) }\CommentTok{# requires lubridate}
\NormalTok{    fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, fSize }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{fsize]}
\NormalTok{    fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, fMTime }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{fmtime]}
\NormalTok{    fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, fMDate }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{as.Date}\NormalTok{(fmtime)]}
\NormalTok{    fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, dateColName }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"unknown - file not loaded (fsize = "}\NormalTok{, fsize, }\StringTok{")"}\NormalTok{)]}
    \CommentTok{# only try to read files where we think there might be data}
\NormalTok{    loadThis <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(fsize }\OperatorTok{>}\StringTok{ }\NormalTok{dataThreshold, }\StringTok{"Loading (fsize > threshold)"}\NormalTok{, }\StringTok{"Skipping (fsize < threshold)"}\NormalTok{)}
    \ControlFlowTok{if}\NormalTok{(fullFb)\{}\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Checking file "}\NormalTok{, loopCount, }\StringTok{" of "}\NormalTok{, nFiles ,}
                            \StringTok{" ("}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\DecValTok{100}\OperatorTok{*}\NormalTok{(loopCount}\OperatorTok{/}\NormalTok{nFiles),}\DecValTok{2}\NormalTok{), }\StringTok{"% checked): "}\NormalTok{, loadThis))\}}
    \ControlFlowTok{if}\NormalTok{(fsize }\OperatorTok{>}\StringTok{ }\NormalTok{dataThreshold)\{}
      \ControlFlowTok{if}\NormalTok{(fullFb)\{}\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"fSize ("}\NormalTok{, fsize, }\StringTok{") > threshold ("}\NormalTok{, dataThreshold, }\StringTok{") -> loading "}\NormalTok{, f))\}}
\NormalTok{      row1DT <-}\StringTok{ }\KeywordTok{fread}\NormalTok{(f, }\DataTypeTok{nrows =} \DecValTok{1}\NormalTok{)}
      \CommentTok{# what is the date column called?}
\NormalTok{      fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, dateColName }\OperatorTok{:}\ErrorTok{=}\StringTok{ "unknown - can't tell"}\NormalTok{]}
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(row1DT, dplyr}\OperatorTok{::}\KeywordTok{contains}\NormalTok{(}\StringTok{"NZ"}\NormalTok{))) }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)\{ }\CommentTok{# requires dplyr}
        \KeywordTok{setnames}\NormalTok{(row1DT, }\StringTok{'date NZ'}\NormalTok{, }\StringTok{"dateTime_char"}\NormalTok{)}
\NormalTok{        row1DT <-}\StringTok{ }\NormalTok{row1DT[, dateColName }\OperatorTok{:}\ErrorTok{=}\StringTok{ "date NZ"}\NormalTok{]}
\NormalTok{        fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, dateColName }\OperatorTok{:}\ErrorTok{=}\StringTok{ "date NZ"}\NormalTok{]}
\NormalTok{      \} }
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(row1DT, dplyr}\OperatorTok{::}\KeywordTok{contains}\NormalTok{(}\StringTok{"UTC"}\NormalTok{))) }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)\{ }\CommentTok{# requires dplyr}
        \KeywordTok{setnames}\NormalTok{(row1DT, }\StringTok{'date UTC'}\NormalTok{, }\StringTok{"dateTime_char"}\NormalTok{)}
\NormalTok{        row1DT <-}\StringTok{ }\NormalTok{row1DT[, dateColName }\OperatorTok{:}\ErrorTok{=}\StringTok{ "date UTC"}\NormalTok{]}
\NormalTok{        fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, dateColName }\OperatorTok{:}\ErrorTok{=}\StringTok{ "date UTC"}\NormalTok{]}
\NormalTok{      \}}
      \CommentTok{# split dateTime}
\NormalTok{      row1DT <-}\StringTok{ }\NormalTok{row1DT[, }\KeywordTok{c}\NormalTok{(}\StringTok{"date_char"}\NormalTok{, }\StringTok{"time_char"}\NormalTok{) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{data.table}\OperatorTok{::}\KeywordTok{tstrsplit}\NormalTok{(dateTime_char, }\StringTok{" "}\NormalTok{)]}
      \CommentTok{# add example of date to metadata - presumably they are the same in each file?!}
\NormalTok{      fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, dateExample }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{row1DT[}\DecValTok{1}\NormalTok{, date_char]]}
      
      \ControlFlowTok{if}\NormalTok{(fullFb)\{}\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Checking date formats in "}\NormalTok{, f))\}}
\NormalTok{      dt <-}\StringTok{ }\KeywordTok{gs_checkDates}\NormalTok{(row1DT)}
\NormalTok{      fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, dateFormat }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{dt[}\DecValTok{1}\NormalTok{, dateFormat]]}
\NormalTok{      fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, dateFormat }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{dt[}\DecValTok{1}\NormalTok{, dateFormat]]}
      \ControlFlowTok{if}\NormalTok{(fullFb)\{}\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Done "}\NormalTok{, f))\}}
\NormalTok{    \}}
\NormalTok{    loopCount <-}\StringTok{ }\NormalTok{loopCount }\OperatorTok{+}\StringTok{ }\DecValTok{1}
\NormalTok{  \}}
  \KeywordTok{print}\NormalTok{(}\StringTok{"All files checked"}\NormalTok{)}
  
  \CommentTok{# any date formats are still ambiguous need a deeper inspection using the full file - could be slow}
\NormalTok{  fAmbig <-}\StringTok{ }\NormalTok{fListCompleteDT[dateFormat }\OperatorTok{==}\StringTok{ "ambiguous"}\NormalTok{, fullPath]}
  
  \ControlFlowTok{for}\NormalTok{(fa }\ControlFlowTok{in}\NormalTok{ fAmbig)\{}
    \ControlFlowTok{if}\NormalTok{(baTest }\OperatorTok{|}\StringTok{ }\NormalTok{fullFb)\{}\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Checking ambiguous date formats in "}\NormalTok{, fa))\}}
\NormalTok{    ambDT <-}\StringTok{ }\KeywordTok{fread}\NormalTok{(fa)}
    \ControlFlowTok{if}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(ambDT, dplyr}\OperatorTok{::}\KeywordTok{contains}\NormalTok{(}\StringTok{"NZ"}\NormalTok{))) }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)\{ }\CommentTok{# requires dplyr}
      \KeywordTok{setnames}\NormalTok{(ambDT, }\StringTok{'date NZ'}\NormalTok{, }\StringTok{"dateTime_char"}\NormalTok{)}
\NormalTok{    \} }
    \ControlFlowTok{if}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(ambDT, dplyr}\OperatorTok{::}\KeywordTok{contains}\NormalTok{(}\StringTok{"UTC"}\NormalTok{))) }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)\{ }\CommentTok{# requires dplyr}
      \KeywordTok{setnames}\NormalTok{(ambDT, }\StringTok{'date UTC'}\NormalTok{, }\StringTok{"dateTime_char"}\NormalTok{)}
\NormalTok{    \}}
\NormalTok{    ambDT <-}\StringTok{ }\NormalTok{ambDT[, }\KeywordTok{c}\NormalTok{(}\StringTok{"date_char"}\NormalTok{, }\StringTok{"time_char"}\NormalTok{) }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{data.table}\OperatorTok{::}\KeywordTok{tstrsplit}\NormalTok{(dateTime_char, }\StringTok{" "}\NormalTok{)]}
\NormalTok{    ambDT <-}\StringTok{ }\KeywordTok{gs_checkDates}\NormalTok{(ambDT)}
    \CommentTok{# set what we now know (or guess!)}
\NormalTok{    fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{fa, dateFormat }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{ambDT[}\DecValTok{1}\NormalTok{,dateFormat]]}
\NormalTok{  \}}
      
\NormalTok{  ofile <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(outPath, fListInterim)}
  \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Saving 1 minute data files interim metadata to "}\NormalTok{, ofile))}
  \KeywordTok{write.csv}\NormalTok{(fListCompleteDT, ofile)}
  \KeywordTok{print}\NormalTok{(}\StringTok{"Done"}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Processing file list and getting file meta-data (please be patient)"
## [1] "All files checked"
## [1] "Saving 1 minute data files interim metadata to /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/fListCompleteDT_interim.csv"
## [1] "Done"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Overall we have "}\NormalTok{, }\KeywordTok{nrow}\NormalTok{(fListCompleteDT), }\StringTok{" files from "}\NormalTok{, }\KeywordTok{uniqueN}\NormalTok{(fListCompleteDT}\OperatorTok{$}\NormalTok{hhID), }\StringTok{" households."}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Overall we have 21440 files from 44 households."
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# for use below}
\NormalTok{nFiles <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(fListCompleteDT)}
\NormalTok{nFilesNotLoaded <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(fListCompleteDT[dateColName }\OperatorTok{%like%}\StringTok{ "unknown"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

Overall we have 21,440 files from 44 households. Of the 21,440, 12,472
(58.17\%) were \emph{not} loaded/checked as their file sizes indicated
that they contained no data.

We now need to check how many of the loaded files have an ambiguous or
default date - these could introduce errors.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# short cut if file list already saved ----}
\CommentTok{#ifile <- paste0(outPath, fListInterim)}
\CommentTok{#print(paste0("Loading 1 minute data files interim metadata to ", ifile))}
\CommentTok{#fListCompleteDT <- fread(ifile)}
  
  
\NormalTok{t <-}\StringTok{ }\NormalTok{fListCompleteDT[, .(}\DataTypeTok{nFiles =}\NormalTok{ .N), keyby =}\StringTok{ }\NormalTok{.(dateColName, dateFormat)]}

\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\DataTypeTok{caption =} \StringTok{"Number of files with given date column names by inferred date format"}\NormalTok{, t)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}llr@{}}
\caption{Number of files with given date column names by inferred date
format}\tabularnewline
\toprule
dateColName & dateFormat & nFiles\tabularnewline
\midrule
\endfirsthead
\toprule
dateColName & dateFormat & nFiles\tabularnewline
\midrule
\endhead
date NZ & dmy - definite & 1\tabularnewline
date NZ & mdy - definite & 2\tabularnewline
date NZ & ymd - default (but day/month value \textless{}= 12) &
12\tabularnewline
date NZ & ymd - definite & 67\tabularnewline
date UTC & ambiguous & 28\tabularnewline
date UTC & ymd - default (but day/month value \textless{}= 12) &
3511\tabularnewline
date UTC & ymd - definite & 5347\tabularnewline
unknown - file not loaded (fsize = 2751) & NA & 1812\tabularnewline
unknown - file not loaded (fsize = 43) & NA & 10660\tabularnewline
\bottomrule
\end{longtable}

Results to note:

\begin{itemize}
\tightlist
\item
  There are 28 ambiguous files
\item
  The non-loaded files only have 2 distinct file sizes, confirming that
  they are unlikely to contain useful data.
\end{itemize}

We now inspect the ambiguous and (some of) the default files.

To help with data cleaning the following table lists files that are
ambiguous.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# list ambigious files}
\NormalTok{aList <-}\StringTok{ }\NormalTok{fListCompleteDT[dateFormat }\OperatorTok{==}\StringTok{ "ambiguous"}\NormalTok{, .(}\DataTypeTok{file =}\NormalTok{ V1, dateColName, dateExample, dateFormat)]}

\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\DataTypeTok{caption =} \StringTok{"Files with ambigious date formats"}\NormalTok{, aList)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}llll@{}}
\caption{Files with ambigious date formats}\tabularnewline
\toprule
file & dateColName & dateExample & dateFormat\tabularnewline
\midrule
\endfirsthead
\toprule
file & dateColName & dateExample & dateFormat\tabularnewline
\midrule
\endhead
rf\_06/15Jul2014-25May2016at1.csv & date UTC & 14/07/14 &
ambiguous\tabularnewline
rf\_07/15Jul2014-25May2016at1.csv & date UTC & 14/07/14 &
ambiguous\tabularnewline
rf\_08/15Jul2014-25May2016at1.csv & date UTC & 14/07/14 &
ambiguous\tabularnewline
rf\_10/15Jul2014-25May2016at1.csv & date UTC & 14/07/14 &
ambiguous\tabularnewline
rf\_11/15Jul2014-25May2016at1.csv & date UTC & 14/07/14 &
ambiguous\tabularnewline
rf\_13/15Jul2014-25May2016at1.csv & date UTC & 14/07/14 &
ambiguous\tabularnewline
rf\_19/15Jul2014-25May2016at1.csv & date UTC & 14/07/14 &
ambiguous\tabularnewline
rf\_21/15Jul2014-25May2016at1.csv & date UTC & 14/07/14 &
ambiguous\tabularnewline
rf\_22/15Jul2014-25May2016at1.csv & date UTC & 14/07/14 &
ambiguous\tabularnewline
rf\_23/15Jul2014-25May2016at1.csv & date UTC & 14/07/14 &
ambiguous\tabularnewline
rf\_24/15Jul2014-25May2016at1.csv & date UTC & 27/07/14 &
ambiguous\tabularnewline
rf\_25/12Oct2016-20Nov2017at1.csv & date UTC & 11-10-16 &
ambiguous\tabularnewline
rf\_26/15Jul2014-25May2016at1.csv & date UTC & 14/07/14 &
ambiguous\tabularnewline
rf\_27/15Jul2014-25May2016at1.csv & date UTC & 27/07/14 &
ambiguous\tabularnewline
rf\_29/24Mar2015-25May2016at1.csv & date UTC & 25/03/15 &
ambiguous\tabularnewline
rf\_30/15Feb2016-25May2016at1.csv & date UTC & 14/02/16 &
ambiguous\tabularnewline
rf\_30/24Mar2015-25May2016at1.csv & date UTC & 27/03/15 &
ambiguous\tabularnewline
rf\_31/24Mar2015-25May2016at1.csv & date UTC & 25/03/15 &
ambiguous\tabularnewline
rf\_34/18Jan2016-25May2016at1.csv & date UTC & 17/01/16 &
ambiguous\tabularnewline
rf\_34/20Jul2015-25May2016at1.csv & date UTC & 19/07/15 &
ambiguous\tabularnewline
rf\_34/24Mar2015-25May2016at1.csv & date UTC & 26/03/15 &
ambiguous\tabularnewline
rf\_35/24Mar2015-25May2016at1.csv & date UTC & 23/03/15 &
ambiguous\tabularnewline
rf\_39/24Mar2015-25May2016at1.csv & date UTC & 27/03/15 &
ambiguous\tabularnewline
rf\_43/24Mar2015-25May2016at1.csv & date UTC & 26/03/15 &
ambiguous\tabularnewline
rf\_43/27Mar2015-18Oct2015at1.csv & date UTC & 26/03/15 &
ambiguous\tabularnewline
rf\_44/24Mar2015-25May2016at1.csv & date UTC & 24/03/15 &
ambiguous\tabularnewline
rf\_46/12Oct2016-20Nov2017at1.csv & date UTC & 11-10-16 &
ambiguous\tabularnewline
rf\_47/24Mar2015-25May2016at1.csv & date UTC & 24/03/15 &
ambiguous\tabularnewline
\bottomrule
\end{longtable}

Looking at the file names we will assume they are dmy.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[dateFormat }\OperatorTok{==}\StringTok{ "ambiguous"}\NormalTok{, dateFormat }\OperatorTok{:}\ErrorTok{=}\StringTok{ "dmy - inferred"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

The following table lists `date NZ' files which are set by default only
- do they look OK to assume dateFormat?

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# list default files}
\NormalTok{aList <-}\StringTok{ }\NormalTok{fListCompleteDT[dateColName }\OperatorTok{==}\StringTok{ "date NZ"} \OperatorTok{&}\StringTok{ }\NormalTok{dateFormat }\OperatorTok{%like%}\StringTok{ "default"}\NormalTok{, .(}\DataTypeTok{file =}\NormalTok{ V1, fSize, dateColName, dateExample, dateFormat)]}

\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\DataTypeTok{caption =} \StringTok{"Files with inferred default date formats"}\NormalTok{, }\KeywordTok{head}\NormalTok{(aList))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lrlll@{}}
\caption{Files with inferred default date formats}\tabularnewline
\toprule
file & fSize & dateColName & dateExample & dateFormat\tabularnewline
\midrule
\endfirsthead
\toprule
file & fSize & dateColName & dateExample & dateFormat\tabularnewline
\midrule
\endhead
rf\_01/1Jan2014-24May2014at1.csv & 6255737 & date NZ & 2014-01-06 & ymd
- default (but day/month value \textless{}= 12)\tabularnewline
rf\_02/1Jan2014-24May2014at1.csv & 6131625 & date NZ & 2014-03-03 & ymd
- default (but day/month value \textless{}= 12)\tabularnewline
rf\_06/24May2014-24May2015at1.csv & 19398444 & date NZ & 2014-06-09 &
ymd - default (but day/month value \textless{}= 12)\tabularnewline
rf\_10/24May2014-24May2015at1.csv & 24386048 & date NZ & 2014-07-09 &
ymd - default (but day/month value \textless{}= 12)\tabularnewline
rf\_11/24May2014-24May2015at1.csv & 23693893 & date NZ & 2014-07-08 &
ymd - default (but day/month value \textless{}= 12)\tabularnewline
rf\_12/24May2014-24May2015at1.csv & 21191785 & date NZ & 2014-07-09 &
ymd - default (but day/month value \textless{}= 12)\tabularnewline
\bottomrule
\end{longtable}

These look OK if we compare the file names with the dateExample.

The following table lists `date NZ' files which are set by default only
- do they look OK to assume dateFormat?

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# list default files}
\NormalTok{aList <-}\StringTok{ }\NormalTok{fListCompleteDT[dateColName }\OperatorTok{==}\StringTok{ "date UTC"} \OperatorTok{&}\StringTok{ }\NormalTok{dateFormat }\OperatorTok{%like%}\StringTok{ "default"}\NormalTok{, .(}\DataTypeTok{file =}\NormalTok{ V1, fSize, dateColName, dateExample, dateFormat)]}

\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\DataTypeTok{caption =} \StringTok{"Files with inferred default date formats"}\NormalTok{, }\KeywordTok{head}\NormalTok{(aList))}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lrlll@{}}
\caption{Files with inferred default date formats}\tabularnewline
\toprule
file & fSize & dateColName & dateExample & dateFormat\tabularnewline
\midrule
\endfirsthead
\toprule
file & fSize & dateColName & dateExample & dateFormat\tabularnewline
\midrule
\endhead
rf\_06/10Apr2018-11Apr2018at1.csv & 156944 & date UTC & 2018-04-09 & ymd
- default (but day/month value \textless{}= 12)\tabularnewline
rf\_06/10Dec2017-11Dec2017at1.csv & 156601 & date UTC & 2017-12-09 & ymd
- default (but day/month value \textless{}= 12)\tabularnewline
rf\_06/10Feb2018-11Feb2018at1.csv & 153353 & date UTC & 2018-02-09 & ymd
- default (but day/month value \textless{}= 12)\tabularnewline
rf\_06/10Jan2018-11Jan2018at1.csv & 153982 & date UTC & 2018-01-09 & ymd
- default (but day/month value \textless{}= 12)\tabularnewline
rf\_06/10Mar2018-11Mar2018at1.csv & 156471 & date UTC & 2018-03-09 & ymd
- default (but day/month value \textless{}= 12)\tabularnewline
rf\_06/10Nov2017-11Nov2017at1.csv & 155639 & date UTC & 2017-11-09 & ymd
- default (but day/month value \textless{}= 12)\tabularnewline
\bottomrule
\end{longtable}

These also look OK so we will stick with the following derived date
formats:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{t <-}\StringTok{ }\NormalTok{fListCompleteDT[, .(}\DataTypeTok{nFiles =}\NormalTok{ .N), keyby =}\StringTok{ }\NormalTok{.(dateColName, dateFormat)]}

\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\DataTypeTok{caption =} \StringTok{"Number of files with given date column names by final imputed date format"}\NormalTok{, t)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}llr@{}}
\caption{Number of files with given date column names by final imputed
date format}\tabularnewline
\toprule
dateColName & dateFormat & nFiles\tabularnewline
\midrule
\endfirsthead
\toprule
dateColName & dateFormat & nFiles\tabularnewline
\midrule
\endhead
date NZ & dmy - definite & 1\tabularnewline
date NZ & mdy - definite & 2\tabularnewline
date NZ & ymd - default (but day/month value \textless{}= 12) &
12\tabularnewline
date NZ & ymd - definite & 67\tabularnewline
date UTC & dmy - inferred & 28\tabularnewline
date UTC & ymd - default (but day/month value \textless{}= 12) &
3511\tabularnewline
date UTC & ymd - definite & 5347\tabularnewline
unknown - file not loaded (fsize = 2751) & NA & 1812\tabularnewline
unknown - file not loaded (fsize = 43) & NA & 10660\tabularnewline
\bottomrule
\end{longtable}

\subsection{Data file quality checks}\label{data-file-quality-checks}

The following chart shows the distribution of these files over time
using their sizes. Note that white indicates the presence of small files
which may not contain observations.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{myCaption <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Data source: "}\NormalTok{, fpath,}
                    \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Using data received up to "}\NormalTok{, }\KeywordTok{Sys.Date}\NormalTok{())}

\NormalTok{plotDT <-}\StringTok{ }\NormalTok{fListCompleteDT[, .(}\DataTypeTok{nFiles =}\NormalTok{ .N,}
                              \DataTypeTok{meanfSize =} \KeywordTok{mean}\NormalTok{(fSize)), }
\NormalTok{                          keyby =}\StringTok{ }\NormalTok{.(hhID, }\DataTypeTok{date =} \KeywordTok{as.Date}\NormalTok{(fMDate))]}

\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggplot}\NormalTok{(plotDT, }\KeywordTok{aes}\NormalTok{( }\DataTypeTok{x =}\NormalTok{ date, }\DataTypeTok{y =}\NormalTok{ hhID, }\DataTypeTok{fill =} \KeywordTok{log}\NormalTok{(meanfSize))) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_tile}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_fill_gradient}\NormalTok{(}\DataTypeTok{low =} \StringTok{"white"}\NormalTok{, }\DataTypeTok{high =} \StringTok{"black"}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{scale_x_date}\NormalTok{(}\DataTypeTok{date_labels =} \StringTok{"%Y %b"}\NormalTok{, }\DataTypeTok{date_breaks =} \StringTok{"1 month"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{90}\NormalTok{, }\DataTypeTok{vjust =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{hjust =} \FloatTok{0.5}\NormalTok{)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \StringTok{"Mean file size of all grid spy data files received per day"}\NormalTok{,}
       \DataTypeTok{caption =} \KeywordTok{paste0}\NormalTok{(myCaption, }
                        \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Log file size used as some files are full year data"}\NormalTok{)}
    
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\includegraphics{processNZGGElecCons1minData_files/figure-html/allFileSizesPlot-1.png}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggsave}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(outPath, }\StringTok{"gridSpyAllFileListSizeTilePlot.png"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Saving 7 x 5 in image
\end{verbatim}

The following chart shows the same chart but only for files which we
think contain data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{myCaption <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"Data source: "}\NormalTok{, fpath,}
                    \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Using data received up to "}\NormalTok{, }\KeywordTok{Sys.Date}\NormalTok{())}

\NormalTok{plotDT <-}\StringTok{ }\NormalTok{fListCompleteDT[}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(dateFormat), .(}\DataTypeTok{nFiles =}\NormalTok{ .N,}
                              \DataTypeTok{meanfSize =} \KeywordTok{mean}\NormalTok{(fSize)), }
\NormalTok{                          keyby =}\StringTok{ }\NormalTok{.(hhID, }\DataTypeTok{date =} \KeywordTok{as.Date}\NormalTok{(fMDate))]}

\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggplot}\NormalTok{(plotDT, }\KeywordTok{aes}\NormalTok{( }\DataTypeTok{x =}\NormalTok{ date, }\DataTypeTok{y =}\NormalTok{ hhID, }\DataTypeTok{fill =} \KeywordTok{log}\NormalTok{(meanfSize))) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_tile}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_fill_gradient}\NormalTok{(}\DataTypeTok{low =} \StringTok{"white"}\NormalTok{, }\DataTypeTok{high =} \StringTok{"black"}\NormalTok{) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{scale_x_date}\NormalTok{(}\DataTypeTok{date_labels =} \StringTok{"%Y %b"}\NormalTok{, }\DataTypeTok{date_breaks =} \StringTok{"1 month"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{90}\NormalTok{, }\DataTypeTok{vjust =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{hjust =} \FloatTok{0.5}\NormalTok{)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \StringTok{"Mean file size of loaded grid spy data files received per day"}\NormalTok{,}
       \DataTypeTok{caption =} \KeywordTok{paste0}\NormalTok{(myCaption, }
                        \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Log file size used as some files are full year data"}\NormalTok{,}
                        \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Files loaded if fsize > "}\NormalTok{, dataThreshold, }\StringTok{" bytes"}\NormalTok{)}
    
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\includegraphics{processNZGGElecCons1minData_files/figure-html/loadedFileSizesPlot-1.png}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggsave}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(outPath, }\StringTok{"gridSpyLoadedFileListSizeTilePlot.png"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Saving 7 x 5 in image
\end{verbatim}

\section{Load data files}\label{load-data-files}

In this section we load the data files that have a file size
\textgreater{} 3000 bytes. Things to note:

\begin{itemize}
\tightlist
\item
  We assume that any files smaller than this value have no observations.
  This is based on:

  \begin{itemize}
  \tightlist
  \item
    Manual inspection of several small files
  \item
    The identical (small) file sizes involved
  \item
    \emph{But} we should probably test the first few lines to double
    check\ldots{}
  \end{itemize}
\item
  We have to deal with quite a lot of duplication some of which has
  caused the different date formats. See our
  \href{https://git.soton.ac.uk/ba1e12/nzGREENGrid/issues?scope=all\&utf8=\%E2\%9C\%93\&state=all}{repo
  issues list}.
\end{itemize}

The following table shows the number of files per household that we
willl load.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{filesToLoadDT <-}\StringTok{ }\NormalTok{fListCompleteDT[}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(dateFormat)]}

\NormalTok{t <-}\StringTok{ }\NormalTok{filesToLoadDT[, .(}\DataTypeTok{nFiles =}\NormalTok{ .N,}
                       \DataTypeTok{meanSize =} \KeywordTok{mean}\NormalTok{(fSize),}
                       \DataTypeTok{minFileDate =} \KeywordTok{min}\NormalTok{(fMDate),}
                       \DataTypeTok{maxFileDate =} \KeywordTok{max}\NormalTok{(fMDate)), keyby =}\StringTok{ }\NormalTok{.(hhID)]}

\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\DataTypeTok{caption =} \StringTok{"Summary of household files to load"}\NormalTok{, t)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lrrll@{}}
\caption{Summary of household files to load}\tabularnewline
\toprule
hhID & nFiles & meanSize & minFileDate & maxFileDate\tabularnewline
\midrule
\endfirsthead
\toprule
hhID & nFiles & meanSize & minFileDate & maxFileDate\tabularnewline
\midrule
\endhead
rf\_01 & 3 & 15548174.7 & 2016-09-20 & 2016-09-30\tabularnewline
rf\_02 & 3 & 10134268.3 & 2016-09-20 & 2016-09-30\tabularnewline
rf\_06 & 186 & 790100.1 & 2016-05-25 & 2018-05-08\tabularnewline
rf\_07 & 186 & 848869.8 & 2016-05-25 & 2018-05-08\tabularnewline
rf\_08 & 5 & 23989121.0 & 2016-05-25 & 2017-11-21\tabularnewline
rf\_09 & 2 & 14344605.0 & 2016-09-21 & 2016-09-21\tabularnewline
rf\_10 & 358 & 525455.0 & 2016-05-25 & 2018-03-30\tabularnewline
rf\_11 & 488 & 424393.7 & 2016-05-25 & 2018-05-08\tabularnewline
rf\_12 & 2 & 10713096.0 & 2016-09-21 & 2016-09-21\tabularnewline
rf\_13 & 420 & 490633.2 & 2016-05-25 & 2018-05-08\tabularnewline
rf\_14 & 329 & 424262.0 & 2016-06-08 & 2017-12-31\tabularnewline
rf\_15 & 2 & 10553143.0 & 2016-09-21 & 2016-09-21\tabularnewline
rf\_16 & 1 & 20037376.0 & 2016-09-20 & 2016-09-20\tabularnewline
rf\_17 & 204 & 411367.1 & 2016-09-21 & 2018-05-06\tabularnewline
rf\_18 & 2 & 14374309.5 & 2016-09-21 & 2016-09-21\tabularnewline
rf\_19 & 488 & 563435.2 & 2016-05-25 & 2018-05-08\tabularnewline
rf\_20 & 2 & 14665810.0 & 2016-09-21 & 2016-09-21\tabularnewline
rf\_21 & 4 & 23058797.8 & 2016-05-25 & 2016-10-12\tabularnewline
rf\_22 & 371 & 533704.5 & 2016-05-25 & 2018-01-16\tabularnewline
rf\_23 & 488 & 439969.2 & 2016-05-25 & 2018-05-08\tabularnewline
rf\_24 & 488 & 428460.4 & 2016-05-25 & 2018-05-08\tabularnewline
rf\_25 & 3 & 12341581.3 & 2016-06-08 & 2017-11-21\tabularnewline
rf\_26 & 394 & 408342.5 & 2016-05-25 & 2018-05-08\tabularnewline
rf\_27 & 3 & 22607698.7 & 2016-05-25 & 2016-09-21\tabularnewline
rf\_28 & 2 & 2297483.0 & 2016-06-08 & 2016-09-19\tabularnewline
rf\_29 & 485 & 341029.8 & 2016-05-25 & 2018-05-08\tabularnewline
rf\_30 & 5 & 13695336.0 & 2016-05-25 & 2016-10-13\tabularnewline
rf\_31 & 488 & 340236.4 & 2016-05-25 & 2018-05-08\tabularnewline
rf\_32 & 2 & 13934454.0 & 2016-06-08 & 2016-09-20\tabularnewline
rf\_33 & 487 & 287260.9 & 2016-06-08 & 2018-05-08\tabularnewline
rf\_34 & 7 & 14106275.3 & 2016-05-25 & 2016-10-13\tabularnewline
rf\_35 & 134 & 573648.6 & 2016-05-25 & 2017-11-21\tabularnewline
rf\_36 & 438 & 299860.1 & 2016-06-08 & 2018-05-08\tabularnewline
rf\_37 & 487 & 301055.7 & 2016-06-08 & 2018-05-08\tabularnewline
rf\_38 & 201 & 385707.5 & 2016-06-08 & 2017-11-21\tabularnewline
rf\_39 & 364 & 381264.0 & 2016-05-25 & 2018-05-08\tabularnewline
rf\_40 & 2 & 9299902.0 & 2016-06-08 & 2016-09-20\tabularnewline
rf\_41 & 479 & 264861.3 & 2016-06-08 & 2018-05-08\tabularnewline
rf\_42 & 45 & 1315953.6 & 2016-06-08 & 2017-11-21\tabularnewline
rf\_43 & 4 & 9442492.0 & 2016-05-25 & 2016-09-28\tabularnewline
rf\_44 & 488 & 341818.6 & 2016-05-25 & 2018-05-08\tabularnewline
rf\_45 & 4 & 10513812.0 & 2016-06-08 & 2017-11-21\tabularnewline
rf\_46 & 411 & 605048.1 & 2016-06-08 & 2018-02-21\tabularnewline
rf\_47 & 3 & 17544847.0 & 2016-05-25 & 2016-09-20\tabularnewline
\bottomrule
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# > Load, process & save the ones which probably have data ----}
\NormalTok{fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[, fileLoaded }\OperatorTok{:}\ErrorTok{=}\StringTok{ "No"}\NormalTok{] }\CommentTok{# set default}
\NormalTok{hhIDs <-}\StringTok{ }\KeywordTok{unique}\NormalTok{(filesToLoadDT}\OperatorTok{$}\NormalTok{hhID) }\CommentTok{# list of household ids}
\NormalTok{hhStatDT <-}\StringTok{ }\NormalTok{data.table}\OperatorTok{::}\KeywordTok{data.table}\NormalTok{() }\CommentTok{# stats collector}

\ControlFlowTok{for}\NormalTok{(hh }\ControlFlowTok{in}\NormalTok{ hhIDs)\{}
\NormalTok{  tempHhDT <-}\StringTok{ }\NormalTok{data.table}\OperatorTok{::}\KeywordTok{data.table}\NormalTok{() }\CommentTok{# hh data collector}
  \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Loading: "}\NormalTok{, hh))}
\NormalTok{  filesToLoad <-}\StringTok{ }\NormalTok{filesToLoadDT[hhID }\OperatorTok{==}\StringTok{ }\NormalTok{hh, fullPath]}
  \ControlFlowTok{for}\NormalTok{(f }\ControlFlowTok{in}\NormalTok{ filesToLoad)\{}
    \ControlFlowTok{if}\NormalTok{(fullFb)\{}\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"File size ("}\NormalTok{, f, }\StringTok{") = "}\NormalTok{, }
\NormalTok{                            filesToLoadDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, fSize], }
                            \StringTok{" so probably OK"}\NormalTok{))\} }\CommentTok{# files under 3kb are probably empty}
    \CommentTok{# attempt to load the file}
\NormalTok{    tempDT <-}\StringTok{ }\NormalTok{data.table}\OperatorTok{::}\KeywordTok{fread}\NormalTok{(f)}
    \ControlFlowTok{if}\NormalTok{(fullFb)\{}\KeywordTok{print}\NormalTok{(}\StringTok{"File loaded"}\NormalTok{)\}}
    \CommentTok{# set some file stats}
\NormalTok{    fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, fileLoaded }\OperatorTok{:}\ErrorTok{=}\StringTok{ "Yes"}\NormalTok{]}
\NormalTok{    fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, nObs }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{nrow}\NormalTok{(tempDT)] }\CommentTok{# could include duplicates}
    
    \CommentTok{# what is the date column called?}
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(tempDT, dplyr}\OperatorTok{::}\KeywordTok{contains}\NormalTok{(}\StringTok{"NZ"}\NormalTok{))) }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)\{ }\CommentTok{# requires dplyr}
        \KeywordTok{setnames}\NormalTok{(tempDT, }\StringTok{'date NZ'}\NormalTok{, }\StringTok{"dateTime_char"}\NormalTok{)}
\NormalTok{        tempDT <-}\StringTok{ }\NormalTok{tempDT[, dateColName }\OperatorTok{:}\ErrorTok{=}\StringTok{ "date NZ"}\NormalTok{]}
\NormalTok{      \} }
      \ControlFlowTok{if}\NormalTok{(}\KeywordTok{nrow}\NormalTok{(dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(tempDT, dplyr}\OperatorTok{::}\KeywordTok{contains}\NormalTok{(}\StringTok{"UTC"}\NormalTok{))) }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{)\{ }\CommentTok{# requires dplyr}
        \KeywordTok{setnames}\NormalTok{(tempDT, }\StringTok{'date UTC'}\NormalTok{, }\StringTok{"dateTime_char"}\NormalTok{)}
\NormalTok{        tempDT <-}\StringTok{ }\NormalTok{tempDT[, dateColName }\OperatorTok{:}\ErrorTok{=}\StringTok{ "date UTC"}\NormalTok{]}
\NormalTok{      \}}
      
      \CommentTok{# Now use the pre-inferred dateFormat}
\NormalTok{      tempDT <-}\StringTok{ }\NormalTok{tempDT[, dateFormat }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{filesToLoadDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, dateFormat]]}
\NormalTok{      tempDT <-}\StringTok{ }\NormalTok{tempDT[dateFormat }\OperatorTok{%like%}\StringTok{ "mdy"} \OperatorTok{&}\StringTok{ }\NormalTok{dateColName }\OperatorTok{%like%}\StringTok{ "NZ"}\NormalTok{, r_dateTime }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{lubridate}\OperatorTok{::}\KeywordTok{mdy_hm}\NormalTok{(dateTime_char, }\DataTypeTok{tz =} \StringTok{"Pacific/Auckland"}\NormalTok{)] }\CommentTok{# requires lubridate}
\NormalTok{      tempDT <-}\StringTok{ }\NormalTok{tempDT[dateFormat }\OperatorTok{%like%}\StringTok{ "dmy"} \OperatorTok{&}\StringTok{ }\NormalTok{dateColName }\OperatorTok{%like%}\StringTok{ "NZ"}\NormalTok{, r_dateTime }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{lubridate}\OperatorTok{::}\KeywordTok{dmy_hm}\NormalTok{(dateTime_char, }\DataTypeTok{tz =} \StringTok{"Pacific/Auckland"}\NormalTok{)] }\CommentTok{# requires lubridate}
\NormalTok{      tempDT <-}\StringTok{ }\NormalTok{tempDT[dateFormat }\OperatorTok{%like%}\StringTok{ "ydm"} \OperatorTok{&}\StringTok{ }\NormalTok{dateColName }\OperatorTok{%like%}\StringTok{ "NZ"}\NormalTok{, r_dateTime }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{lubridate}\OperatorTok{::}\KeywordTok{ymd_hm}\NormalTok{(dateTime_char, }\DataTypeTok{tz =} \StringTok{"Pacific/Auckland"}\NormalTok{)] }\CommentTok{# requires lubridate}
\NormalTok{      tempDT <-}\StringTok{ }\NormalTok{tempDT[dateFormat }\OperatorTok{%like%}\StringTok{ "ymd"} \OperatorTok{&}\StringTok{ }\NormalTok{dateColName }\OperatorTok{%like%}\StringTok{ "NZ"}\NormalTok{, r_dateTime }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{lubridate}\OperatorTok{::}\KeywordTok{ymd_hm}\NormalTok{(dateTime_char, }\DataTypeTok{tz =} \StringTok{"Pacific/Auckland"}\NormalTok{)] }\CommentTok{# requires lubridate}
\NormalTok{      tempDT <-}\StringTok{ }\NormalTok{tempDT[dateFormat }\OperatorTok{%like%}\StringTok{ "mdy"} \OperatorTok{&}\StringTok{ }\NormalTok{dateColName }\OperatorTok{%like%}\StringTok{ "UTC"}\NormalTok{, r_dateTime }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{lubridate}\OperatorTok{::}\KeywordTok{mdy_hm}\NormalTok{(dateTime_char, }\DataTypeTok{tz =} \StringTok{"UTC"}\NormalTok{)] }\CommentTok{# requires lubridate}
\NormalTok{      tempDT <-}\StringTok{ }\NormalTok{tempDT[dateFormat }\OperatorTok{%like%}\StringTok{ "dmy"} \OperatorTok{&}\StringTok{ }\NormalTok{dateColName }\OperatorTok{%like%}\StringTok{ "UTC"}\NormalTok{, r_dateTime }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{lubridate}\OperatorTok{::}\KeywordTok{dmy_hm}\NormalTok{(dateTime_char, }\DataTypeTok{tz =} \StringTok{"UTC"}\NormalTok{)] }\CommentTok{# requires lubridate}
\NormalTok{      tempDT <-}\StringTok{ }\NormalTok{tempDT[dateFormat }\OperatorTok{%like%}\StringTok{ "ydm"} \OperatorTok{&}\StringTok{ }\NormalTok{dateColName }\OperatorTok{%like%}\StringTok{ "UTC"}\NormalTok{, r_dateTime }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{lubridate}\OperatorTok{::}\KeywordTok{ymd_hm}\NormalTok{(dateTime_char, }\DataTypeTok{tz =} \StringTok{"UTC"}\NormalTok{)] }\CommentTok{# requires lubridate}
\NormalTok{      tempDT <-}\StringTok{ }\NormalTok{tempDT[dateFormat }\OperatorTok{%like%}\StringTok{ "ymd"} \OperatorTok{&}\StringTok{ }\NormalTok{dateColName }\OperatorTok{%like%}\StringTok{ "UTC"}\NormalTok{, r_dateTime }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{lubridate}\OperatorTok{::}\KeywordTok{ymd_hm}\NormalTok{(dateTime_char, }\DataTypeTok{tz =} \StringTok{"UTC"}\NormalTok{)] }\CommentTok{# requires lubridate}
      \ControlFlowTok{if}\NormalTok{(fullFb)\{}
        \KeywordTok{print}\NormalTok{(}\KeywordTok{head}\NormalTok{(tempDT))}
        \KeywordTok{print}\NormalTok{(}\KeywordTok{summary}\NormalTok{(tempDT))}
        \CommentTok{#print(table(tempDT$dateFormat))}
\NormalTok{        \}}
    
\NormalTok{    fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, obsStartDate }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{min}\NormalTok{(}\KeywordTok{as.Date}\NormalTok{(tempDT}\OperatorTok{$}\NormalTok{r_dateTime))] }\CommentTok{# should be a sensible number and not NA}
\NormalTok{    fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, obsEndDate }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{max}\NormalTok{(}\KeywordTok{as.Date}\NormalTok{(tempDT}\OperatorTok{$}\NormalTok{r_dateTime))] }\CommentTok{# should be a sensible number and not NA}
\NormalTok{    fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, nObs }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{nrow}\NormalTok{(tempDT)]}
\NormalTok{    fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, circuitLabels }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{toString}\NormalTok{(}\KeywordTok{sort}\NormalTok{(}\KeywordTok{colnames}\NormalTok{(dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(tempDT, }
\NormalTok{                                                                                                            dplyr}\OperatorTok{::}\KeywordTok{contains}\NormalTok{(}\StringTok{"$"}\NormalTok{)))))] }\CommentTok{# check the names of circuits - all seem to contain "$"; sort them to make it easier to compare them - this is the only way we have to check if data from different households has been placed in the wrong folder.}
\NormalTok{    fListCompleteDT <-}\StringTok{ }\NormalTok{fListCompleteDT[fullPath }\OperatorTok{==}\StringTok{ }\NormalTok{f, nCircuits }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\KeywordTok{ncol}\NormalTok{(dplyr}\OperatorTok{::}\KeywordTok{select}\NormalTok{(tempDT, }
\NormalTok{                                                                                      dplyr}\OperatorTok{::}\KeywordTok{contains}\NormalTok{(}\StringTok{"$"}\NormalTok{)))] }\CommentTok{# check for the number of circuits - all seem to contain "$"}
    \CommentTok{#tempDT <- tempDT[, sourceFile := f] # record for later checks - breaks de-duplication code}
    \CommentTok{# rbind to hh data collector}
\NormalTok{    tempHhDT <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(tempHhDT, tempDT, }\DataTypeTok{fill =} \OtherTok{TRUE}\NormalTok{) }\CommentTok{# fill just in case there are different numbers of columns or columns with different names (quite likely - crcuit labels may vary!)}
\NormalTok{  \}}
  
  \CommentTok{# > Remove duplicates caused by over-lapping files and dates etc ----}
  \CommentTok{# Need to remove all uneccessary vars for this to work}
  \CommentTok{# Any remaining duplicates will probably be due to over-lapping files which have different circuit labels - see table below}
  \KeywordTok{try}\NormalTok{(tempHhDT}\OperatorTok{$}\NormalTok{dateColName <-}\StringTok{ }\OtherTok{NULL}\NormalTok{)}
  \KeywordTok{try}\NormalTok{(tempHhDT}\OperatorTok{$}\NormalTok{dateFormat <-}\StringTok{ }\OtherTok{NULL}\NormalTok{)}
  \KeywordTok{try}\NormalTok{(tempHhDT}\OperatorTok{$}\NormalTok{dateTime_char <-}\StringTok{ }\OtherTok{NULL}\NormalTok{) }\CommentTok{# if we leave this one in then we get duplicates where we have date NZ & date UTC for the same timestamp due to overlapping file downloads}
  
\NormalTok{  nObs <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(tempHhDT)}
  \ControlFlowTok{if}\NormalTok{(fullFb)\{}\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"N rows before removal of duplicates: "}\NormalTok{, nObs))\}}
\NormalTok{  tempHhDT <-}\StringTok{ }\KeywordTok{unique}\NormalTok{(tempHhDT)}
\NormalTok{  nObs <-}\StringTok{ }\KeywordTok{nrow}\NormalTok{(tempHhDT)}
  \ControlFlowTok{if}\NormalTok{(fullFb)\{}\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"N rows after removal of duplicates: "}\NormalTok{, nObs))\}}
  
\NormalTok{  hhStatTempDT <-}\StringTok{ }\NormalTok{tempHhDT[, .(}\DataTypeTok{nObs =}\NormalTok{ .N,}
                           \DataTypeTok{nDataColumns =} \KeywordTok{ncol}\NormalTok{(}\KeywordTok{select}\NormalTok{(tempDT, }\KeywordTok{contains}\NormalTok{(}\StringTok{"$"}\NormalTok{)))), }\CommentTok{# the actual number of columns in the whole household file with "$" in them in case of rbind "errors" caused by files with different column names}
\NormalTok{                           keyby =}\StringTok{ }\NormalTok{(}\DataTypeTok{date =} \KeywordTok{as.Date}\NormalTok{(r_dateTime))] }\CommentTok{# can't do sensible summary stats on W as some circuits are sub-sets of others!}
  \CommentTok{# add hhID}
\NormalTok{  hhStatTempDT <-}\StringTok{ }\NormalTok{hhStatTempDT[, hhID }\OperatorTok{:}\ErrorTok{=}\StringTok{ }\NormalTok{hh]}
  
\NormalTok{  hhStatDT <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(hhStatDT,hhStatTempDT) }\CommentTok{# add to the collector}
  
  \CommentTok{# > Save hh file ----}
  
\NormalTok{  ofile <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(outPath, }\StringTok{"data/"}\NormalTok{, hh,}\StringTok{"_all_1min_data.csv"}\NormalTok{)}
  \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Saving "}\NormalTok{, ofile, }\StringTok{"..."}\NormalTok{))}
  \KeywordTok{write_csv}\NormalTok{(tempHhDT, ofile)}
  \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Saved "}\NormalTok{, ofile, }\StringTok{", gzipping..."}\NormalTok{))}
  
\NormalTok{  cmd <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(}\StringTok{"gzip -f "}\NormalTok{, }\StringTok{"'"}\NormalTok{, }\KeywordTok{path.expand}\NormalTok{(ofile), }\StringTok{"'"}\NormalTok{) }\CommentTok{# gzip it - use quotes in case of spaces in file name, expand path if needed}
  \KeywordTok{try}\NormalTok{(}\KeywordTok{system}\NormalTok{(cmd)) }\CommentTok{# in case it fails - if it does there will just be .csv files (not gzipped) - e.g. under windows}
  \KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Gzipped "}\NormalTok{, ofile))}
  
    \ControlFlowTok{if}\NormalTok{(fullFb)\{}
    \KeywordTok{print}\NormalTok{(}\StringTok{"Col names: "}\NormalTok{)}
    \KeywordTok{print}\NormalTok{(}\KeywordTok{names}\NormalTok{(tempHhDT))}
\NormalTok{    \}}
  
\NormalTok{  tempHhDT <-}\StringTok{ }\OtherTok{NULL} \CommentTok{# just in case}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Loading: rf_01"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_01_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_01_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_01_all_1min_data.csv"
## [1] "Loading: rf_02"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_02_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_02_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_02_all_1min_data.csv"
## [1] "Loading: rf_06"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_06_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_06_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_06_all_1min_data.csv"
## [1] "Loading: rf_07"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_07_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_07_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_07_all_1min_data.csv"
## [1] "Loading: rf_08"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_08_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_08_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_08_all_1min_data.csv"
## [1] "Loading: rf_09"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_09_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_09_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_09_all_1min_data.csv"
## [1] "Loading: rf_10"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_10_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_10_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_10_all_1min_data.csv"
## [1] "Loading: rf_11"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_11_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_11_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_11_all_1min_data.csv"
## [1] "Loading: rf_12"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_12_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_12_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_12_all_1min_data.csv"
## [1] "Loading: rf_13"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_13_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_13_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_13_all_1min_data.csv"
## [1] "Loading: rf_14"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_14_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_14_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_14_all_1min_data.csv"
## [1] "Loading: rf_15"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_15_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_15_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_15_all_1min_data.csv"
## [1] "Loading: rf_16"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_16_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_16_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_16_all_1min_data.csv"
## [1] "Loading: rf_17"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_17_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_17_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_17_all_1min_data.csv"
## [1] "Loading: rf_18"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_18_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_18_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_18_all_1min_data.csv"
## [1] "Loading: rf_19"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_19_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_19_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_19_all_1min_data.csv"
## [1] "Loading: rf_20"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_20_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_20_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_20_all_1min_data.csv"
## [1] "Loading: rf_21"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_21_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_21_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_21_all_1min_data.csv"
## [1] "Loading: rf_22"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_22_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_22_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_22_all_1min_data.csv"
## [1] "Loading: rf_23"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_23_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_23_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_23_all_1min_data.csv"
## [1] "Loading: rf_24"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_24_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_24_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_24_all_1min_data.csv"
## [1] "Loading: rf_25"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_25_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_25_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_25_all_1min_data.csv"
## [1] "Loading: rf_26"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_26_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_26_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_26_all_1min_data.csv"
## [1] "Loading: rf_27"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_27_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_27_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_27_all_1min_data.csv"
## [1] "Loading: rf_28"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_28_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_28_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_28_all_1min_data.csv"
## [1] "Loading: rf_29"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_29_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_29_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_29_all_1min_data.csv"
## [1] "Loading: rf_30"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_30_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_30_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_30_all_1min_data.csv"
## [1] "Loading: rf_31"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_31_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_31_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_31_all_1min_data.csv"
## [1] "Loading: rf_32"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_32_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_32_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_32_all_1min_data.csv"
## [1] "Loading: rf_33"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_33_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_33_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_33_all_1min_data.csv"
## [1] "Loading: rf_34"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_34_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_34_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_34_all_1min_data.csv"
## [1] "Loading: rf_35"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_35_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_35_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_35_all_1min_data.csv"
## [1] "Loading: rf_36"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_36_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_36_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_36_all_1min_data.csv"
## [1] "Loading: rf_37"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_37_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_37_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_37_all_1min_data.csv"
## [1] "Loading: rf_38"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_38_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_38_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_38_all_1min_data.csv"
## [1] "Loading: rf_39"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_39_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_39_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_39_all_1min_data.csv"
## [1] "Loading: rf_40"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_40_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_40_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_40_all_1min_data.csv"
## [1] "Loading: rf_41"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_41_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_41_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_41_all_1min_data.csv"
## [1] "Loading: rf_42"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_42_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_42_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_42_all_1min_data.csv"
## [1] "Loading: rf_43"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_43_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_43_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_43_all_1min_data.csv"
## [1] "Loading: rf_44"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_44_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_44_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_44_all_1min_data.csv"
## [1] "Loading: rf_45"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_45_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_45_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_45_all_1min_data.csv"
## [1] "Loading: rf_46"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_46_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_46_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_46_all_1min_data.csv"
## [1] "Loading: rf_47"
## [1] "Saving /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_47_all_1min_data.csv..."
## [1] "Saved /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_47_all_1min_data.csv, gzipping..."
## [1] "Gzipped /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/data/rf_47_all_1min_data.csv"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#> Save observed data stats for all files loaded ----}
\NormalTok{ofile <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(outPath, }\StringTok{"hhDailyObservationsStats.csv"}\NormalTok{)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Saving daily observations stats by hhid to "}\NormalTok{, ofile)) }\CommentTok{# write out version with file stats}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Saving daily observations stats by hhid to /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/hhDailyObservationsStats.csv"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{write.csv}\NormalTok{(hhStatDT, ofile)}
\KeywordTok{print}\NormalTok{(}\StringTok{"Done"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Done"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ofile <-}\StringTok{ }\KeywordTok{paste0}\NormalTok{(outPath, fListFinal)}
\KeywordTok{print}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(}\StringTok{"Saving 1 minute data files final metadata to "}\NormalTok{, ofile))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Saving 1 minute data files final metadata to /Volumes/hum-csafe/Research Projects/GREEN Grid/Clean_data/safe/gridSpy/1min/fListCompleteDT_final.csv"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{write.csv}\NormalTok{(fListCompleteDT, ofile)}
\KeywordTok{print}\NormalTok{(}\StringTok{"Done"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Done"
\end{verbatim}

\section{Data quality analysis}\label{data-quality-analysis}

Now produce some data quality plots \& tables.

\subsection{Circuit label checks}\label{circuit-label-checks}

The following table shows the number of data files with different
circuit labels by household. In theory there should only be one unique
list per household and it should be present in every data file.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# short cut if exists already}
\CommentTok{#ifile <- paste0(outPath, fListFinal)}
\CommentTok{#fListCompleteDT <- fread(ifile)}
\NormalTok{t <-}\StringTok{ }\KeywordTok{table}\NormalTok{(fListCompleteDT}\OperatorTok{$}\NormalTok{hhID,fListCompleteDT}\OperatorTok{$}\NormalTok{circuitLabels)}
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\DataTypeTok{caption =} \StringTok{"Circuit labels list by household"}\NormalTok{, t)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrr@{}}
\caption{Circuit labels list by household}\tabularnewline
\toprule
& Bed 2, 2nd Fridge\$2828, Heat Pump\$2826, Hot Water -
Controlled\$2825, Incomer - Uncontrolled\$2824, Kitchen, Laundry \& Beds
1\&3\$2829, Oven \& Oven Wall Appliances\$2827 & Bedroom \& Lounge Heat
Pumps\$2741, Incomer 1 - All\$2738, Incomer 2 - All\$2737, Kitchen
Appliances\$2735, Laundry\$2734, Oven\$2736, PV 1\$2739, PV 2\$2733,
Theatre Heat Pump\$2740 & Bedrooms \& Lounge\$2602, Heat Pump\$2598,
Incomer - All\$2599, Kitchen Appliances\$2601, Laundry \& Garage\$2597,
Oven\$2600 & Cooking Bath tile heat\$1573, Fridge\$1572, Heating\$1576,
Hot Water\$1574, Lights\$1577, Mains\$1575 & Downstairs (inc 1 Heat
Pump)\$2212, Hot Water - Controlled\$2208, Incomer - Uncontrolled\$2209,
Kitchen \& Laundry\$2213, Oven \& Hob\$2210, Upstairs Heat Pumps\$2211 &
Fridge\$2752, Heat Pump \& Washing Machine\$2750, Incomer - All\$2748,
Kitchen Appliances \& Garage\$2753, Lower Bedrooms \& Bathrooms\$2751,
Oven\$2749 & Hallway \& Washing Machine\$2683, Hot Water -
Controlled\$2679, Incomer 1 - Uncont inc Oven\$2681, Incomer 2 - Uncont
inc Stove\$2680, Kitchen Appliances \& Bedrooms\$2684, Microwave \&
Breadmaker\$2682 & Heat Pump (x2) \& Lounge Power\$4166, Hot Water -
Controlled\$4167, Incomer - Uncontrolled\$4168, Kitchen
Appliances\$4163, Laundry\$4164, Lighting\$4165 & Heat Pump \& 2 x
Bathroom Heat\$4171, Incomer - All\$4170, Kitchen Power \& Heat,
Lounge\$4174, Laundry, Garage \& 2 Bedrooms\$4173, Lighting\$4172, Wall
Oven\$4169 & Heat Pump \& Bedroom 2\$2731, Incomer 1 - Uncont - Inc
Hob\$2729, Incomer 2 - Uncont - Inc Oven\$2730, Kitchen
Appliances\$2727, Laundry\$2732, Lounge, Dining \& Bedrooms\$2728 & Heat
Pump \& Kitchen Appliances\$4186, Hot Water - Controlled\$4184, Incomer
- Uncontrolled\$4181, Laundry\$4185, Lighting\$4183, Oven\$4182 & Heat
Pump \& Lounge\$2590, Hob\$2589, Hot Water Cpbd Heater- Cont\$2586,
Incomer - Uncontrolled\$2585, Kitchen Appliances \& Laundry\$2588, Spa -
Uncontrolled\$2587 & Heat Pump \& Misc\$2107, Hob\$2109, Hot Water -
Controlled\$2110, Incomer 1 - Uncontrolled\$2112, Incomer 2 -
Uncontrolled\$2111, Oven \& Kitchen Appliances\$2108 & Heat Pump\$2092,
Hot Water - Controlled\$2094, Incomer - Uncontrolled\$2093,
Kitchen\$2089, Laundry \& 2nd Fridge Freezer\$2090, Oven \& Hob\$2091 &
Heat Pump\$2148, Hot Water - Controlled\$2150, Incomer 1 - Uncont - inc
Hob\$2152, Incomer 2 - Uncont - inc Oven\$2151, Kitchen
Appliances\$2147, Laundry\$2149 & Heat Pump\$2758, Hob \& Kitchen
Appliances\$2759, Hot Water - Controlled\$2761, Incomer 1 - Uncontrolled
\$2763, Incomer 1 - Uncontrolled\$2757, Incomer 2 - Uncontrolled \$2762,
Oven\$2760 & Heat Pump\$2758, Hob \& Kitchen Appliances\$2759, Hot Water
- Controlled\$2761, Incomer 1 - Uncontrolled \$2763, Incomer 2 -
Uncontrolled \$2762, Oven\$2760 & Heat Pump\$4124, Hot Water -
Uncontrolled\$4125, Incomer - Uncontrolled\$4126, Kitchen
Appliances\$4121, Laundry, Garage Fridge Freezer\$4122, Lighting\$4123 &
Heat Pump\$4130, Hot Water - Uncontrolled\$4131, Incomer - All\$4132,
Kitchen Appliances\$4127, Laundry \& Freezer\$4128, Lighting (inc heat
lamps)\$4129 & Heat Pump\$4134, Hot Water - Controlled\$4135, Incomer
-Uncontrolled\$4136, Kitchen Appliances\$4137, Laundry \& Fridge
Freezer\$4138, Lighting\$4133 & Heat Pump\$4150, Hot Water -
Uncontrolled\$4147, Incomer - All\$4148, Kitchen Appliances\$4145,
Lighting\$4149, Washing Machine\$4146 & Heat Pump\$4154, Hot Water -
Controlled\$4155, Incomer - Uncontrolled\$4156, Kitchen
Appliances\$4151, Laundry \$4152, Lighting\$4153 & Heat Pump\$4160, Hot
Water - Controlled\$4158, Incomer - Uncontrolled\$4157, Kitchen
Appliances\$4161, Laundry \& Garage Fridge\$4162, Lighting\$4159 & Heat
Pump\$4175, Hot Water - Controlled\$4178, Incomer - Uncontrolled\$4177,
Kitchen, Dining \& Office\$4179, Laundry, Lounge, Garage, Bed\$4180,
Lighting\$4176 & Heat Pump\$4190, Incomer - All\$4192, Kitchen
Appliances\$4187, Laundry\$4188, Lighting\$4189, Oven\$4191 & Heat
Pump\$4196, Hot Water - Controlled\$4198, Incomer - All\$4193, Kitchen
Appliances\$4195, Laundry\$4194, Lighting\$4197 & Heat Pump\$4204, Hot
Water - Controlled\$4200, Incomer - All\$4199, Kitchen Appliances\$4201,
Laundry\$4202, Lighting\$4203 & Heat Pump\$4211, Incomer - All\$4213,
Kitchen Appliances\$4210, Laundry, Garage \& Guest Bed\$4215,
Lighting\$4212, Oven\$4214 & Heat Pump\$4219, Incomer - All\$4221,
Kitchen Appliances\$4216, Laundry\$4217, Lighting\$4218, PV \&
Garage\$4220 & Heat Pump\$4223, Hot Water - Uncontrolled\$4224, Incomer
- All\$4225, Kitchen Appliances\$4226, Laundry \& Garage Freezer\$4227,
Lighting\$4222 & Heat Pumps (2x) \& Power\_Imag\$4399, Heat Pumps (2x)
\& Power\$4232, Hot Water - Controlled\_Imag\$4400, Hot Water -
Controlled\$4231, Incomer - Uncontrolled\_Imag\$4401, Incomer -
Uncontrolled\$4230, Incomer Voltage\$4405, Kitchen \&
Bedrooms\_Imag\$4402, Kitchen \& Bedrooms\$4229, Laundry \&
Bedrooms\_Imag\$4403, Laundry \& Bedrooms\$4228, Lighting\_Imag\$4404,
Lighting\$4233 & Heat Pumps (2x) \& Power\$4232, Heat Pumps (2x) \&
Power\$4399, Hot Water - Controlled\$4231, Hot Water - Controlled\$4400,
Incomer - Uncontrolled\$4230, Incomer - Uncontrolled\$4401, Incomer
Voltage\$4405, Kitchen \& Bedrooms\$4229, Kitchen \& Bedrooms\$4402,
Laundry \& Bedrooms\$4228, Laundry \& Bedrooms\$4403, Lighting\$4233,
Lighting\$4404 & Heat Pumps (2x) \& Power1\$4232, Heat Pumps (2x) \&
Power2\$4399, Hot Water - Controlled1\$4231, Hot Water -
Controlled2\$4400, Incomer - Uncontrolled1\$4230, Incomer -
Uncontrolled2\$4401, Incomer Voltage\$4405, Kitchen \& Bedrooms1\$4229,
Kitchen \& Bedrooms2\$4402, Laundry \& Bedrooms1\$4228, Laundry \&
Bedrooms2\$4403, Lighting1\$4233, Lighting2\$4404 & Heating\$1633, Hot
water\$1636, Kitchen power\$1632, Lights\$1635, Mains\$1634, Range\$1637
& Hob\$3954, Hot Water\$3952, Incomer 1\$3956, Incomer 2\$3955, Laundry
\& Kitchen Appliances\$3951, Oven\$3953 & Hot Water (2 elements)\$4247,
Incomer - Uncontrolled\$4248, Kitchen Appliances\$4244, Lighting \& 2
Towel Rail\$4245, Oven\$4246 & Hot Water - Controlled (HEMS)\$2081,
Incomer - Uncontrolled\$2082, Kitchen, Laundry \& Ventilation\$2084,
Oven\$2085, PV \& Storage\$2083, Spa (HEMS)\$2080 & Hot Water -
Controlled\$2102, Incomer - Uncontrolled\$2101, Kitchen\$2104, Laundry,
Fridge \& Freezer\$2105, Oven \& Hob\$2103, PV\$2106 & Hot Water -
Controlled\$2129, Incomer 1 - Uncontrolled\$2128, Incomer 2 -
Uncontrolled\$2130, Kitchen Appliances \& Ventilati\$2131, Laundry \&
Hob\$2133, Oven\$2132 & Hot Water - Controlled\$2236, Incomer -
Uncontrolled\$2237, Kitchen \& Laundry\$2234, Lighting\$2232,
Oven\$2235, Ventilation \& Lounge Power\$2233 & Hot Water -
Controlled\$2248, Incomer - Uncontrolled\$2249, Kitchen\$2246, Laundry,
Downstairs \& Lounge\$2245, Lighting\$2244, Oven \& Hob\$2247 & Hot
Water - Controlled\$2719, Incomer 1 - Uncont inc Stove\$2718, Incomer 2
- Uncont inc Oven\$2717, Kitchen Appliances\$2715, Laundry \&
Microwave\$2720, Power Outlets\$2716 & Hot Water - Controlled\$4144,
Incomer - Uncontrolled\$4143, Kitchen Appliances \& Heat Pump\$4140,
Laundry \& Teenagers Bedroom\$4139, Lighting\$4142, Oven, Hob \&
Microwave\$4141 & Hot Water - Controlled\$4238, Incomer - All\$4239,
Kitchen Appliances\$4234, Laundry \& Kitchen\$4235, Lighting\$4236, Oven
\& Hobb\$4237 & Incomer 1 - All\$2703, Incomer 2 - All\$2704, Kitchen
Appliances\$2706, Laundry, Sauna \& 2nd Fridge\$2707, Oven\$2705,
Spa\$2708 & Incomer 1 - Hot Water - Cont\$2626, Incomer 2 -
Uncontrolled\$2625, Incomer 3 - Uncontrolled\$2627, Kitchen Appliances
\& Lounge\$2630, Laundry, Fridge \& Microwave\$2628, Oven\$2629 &
Incomer 1 - inc Top Oven\$5620, Incomer 2 - inc Bottom Oven\$5621,
Kitchen Appliances\$5625, Laundry \& Garage\$5624, Lighting 1/2\$5623,
Lighting 2/2\$5622 & Incomer 1 - Uncontrolled\$2726, Incomer 2 -
Uncontrolled\$2725, Kitchen Appliances \& Laundry\$2722,
Microwave\$2721, Oven\$2724, Workshop\$2723\tabularnewline
\midrule
\endfirsthead
\toprule
& Bed 2, 2nd Fridge\$2828, Heat Pump\$2826, Hot Water -
Controlled\$2825, Incomer - Uncontrolled\$2824, Kitchen, Laundry \& Beds
1\&3\$2829, Oven \& Oven Wall Appliances\$2827 & Bedroom \& Lounge Heat
Pumps\$2741, Incomer 1 - All\$2738, Incomer 2 - All\$2737, Kitchen
Appliances\$2735, Laundry\$2734, Oven\$2736, PV 1\$2739, PV 2\$2733,
Theatre Heat Pump\$2740 & Bedrooms \& Lounge\$2602, Heat Pump\$2598,
Incomer - All\$2599, Kitchen Appliances\$2601, Laundry \& Garage\$2597,
Oven\$2600 & Cooking Bath tile heat\$1573, Fridge\$1572, Heating\$1576,
Hot Water\$1574, Lights\$1577, Mains\$1575 & Downstairs (inc 1 Heat
Pump)\$2212, Hot Water - Controlled\$2208, Incomer - Uncontrolled\$2209,
Kitchen \& Laundry\$2213, Oven \& Hob\$2210, Upstairs Heat Pumps\$2211 &
Fridge\$2752, Heat Pump \& Washing Machine\$2750, Incomer - All\$2748,
Kitchen Appliances \& Garage\$2753, Lower Bedrooms \& Bathrooms\$2751,
Oven\$2749 & Hallway \& Washing Machine\$2683, Hot Water -
Controlled\$2679, Incomer 1 - Uncont inc Oven\$2681, Incomer 2 - Uncont
inc Stove\$2680, Kitchen Appliances \& Bedrooms\$2684, Microwave \&
Breadmaker\$2682 & Heat Pump (x2) \& Lounge Power\$4166, Hot Water -
Controlled\$4167, Incomer - Uncontrolled\$4168, Kitchen
Appliances\$4163, Laundry\$4164, Lighting\$4165 & Heat Pump \& 2 x
Bathroom Heat\$4171, Incomer - All\$4170, Kitchen Power \& Heat,
Lounge\$4174, Laundry, Garage \& 2 Bedrooms\$4173, Lighting\$4172, Wall
Oven\$4169 & Heat Pump \& Bedroom 2\$2731, Incomer 1 - Uncont - Inc
Hob\$2729, Incomer 2 - Uncont - Inc Oven\$2730, Kitchen
Appliances\$2727, Laundry\$2732, Lounge, Dining \& Bedrooms\$2728 & Heat
Pump \& Kitchen Appliances\$4186, Hot Water - Controlled\$4184, Incomer
- Uncontrolled\$4181, Laundry\$4185, Lighting\$4183, Oven\$4182 & Heat
Pump \& Lounge\$2590, Hob\$2589, Hot Water Cpbd Heater- Cont\$2586,
Incomer - Uncontrolled\$2585, Kitchen Appliances \& Laundry\$2588, Spa -
Uncontrolled\$2587 & Heat Pump \& Misc\$2107, Hob\$2109, Hot Water -
Controlled\$2110, Incomer 1 - Uncontrolled\$2112, Incomer 2 -
Uncontrolled\$2111, Oven \& Kitchen Appliances\$2108 & Heat Pump\$2092,
Hot Water - Controlled\$2094, Incomer - Uncontrolled\$2093,
Kitchen\$2089, Laundry \& 2nd Fridge Freezer\$2090, Oven \& Hob\$2091 &
Heat Pump\$2148, Hot Water - Controlled\$2150, Incomer 1 - Uncont - inc
Hob\$2152, Incomer 2 - Uncont - inc Oven\$2151, Kitchen
Appliances\$2147, Laundry\$2149 & Heat Pump\$2758, Hob \& Kitchen
Appliances\$2759, Hot Water - Controlled\$2761, Incomer 1 - Uncontrolled
\$2763, Incomer 1 - Uncontrolled\$2757, Incomer 2 - Uncontrolled \$2762,
Oven\$2760 & Heat Pump\$2758, Hob \& Kitchen Appliances\$2759, Hot Water
- Controlled\$2761, Incomer 1 - Uncontrolled \$2763, Incomer 2 -
Uncontrolled \$2762, Oven\$2760 & Heat Pump\$4124, Hot Water -
Uncontrolled\$4125, Incomer - Uncontrolled\$4126, Kitchen
Appliances\$4121, Laundry, Garage Fridge Freezer\$4122, Lighting\$4123 &
Heat Pump\$4130, Hot Water - Uncontrolled\$4131, Incomer - All\$4132,
Kitchen Appliances\$4127, Laundry \& Freezer\$4128, Lighting (inc heat
lamps)\$4129 & Heat Pump\$4134, Hot Water - Controlled\$4135, Incomer
-Uncontrolled\$4136, Kitchen Appliances\$4137, Laundry \& Fridge
Freezer\$4138, Lighting\$4133 & Heat Pump\$4150, Hot Water -
Uncontrolled\$4147, Incomer - All\$4148, Kitchen Appliances\$4145,
Lighting\$4149, Washing Machine\$4146 & Heat Pump\$4154, Hot Water -
Controlled\$4155, Incomer - Uncontrolled\$4156, Kitchen
Appliances\$4151, Laundry \$4152, Lighting\$4153 & Heat Pump\$4160, Hot
Water - Controlled\$4158, Incomer - Uncontrolled\$4157, Kitchen
Appliances\$4161, Laundry \& Garage Fridge\$4162, Lighting\$4159 & Heat
Pump\$4175, Hot Water - Controlled\$4178, Incomer - Uncontrolled\$4177,
Kitchen, Dining \& Office\$4179, Laundry, Lounge, Garage, Bed\$4180,
Lighting\$4176 & Heat Pump\$4190, Incomer - All\$4192, Kitchen
Appliances\$4187, Laundry\$4188, Lighting\$4189, Oven\$4191 & Heat
Pump\$4196, Hot Water - Controlled\$4198, Incomer - All\$4193, Kitchen
Appliances\$4195, Laundry\$4194, Lighting\$4197 & Heat Pump\$4204, Hot
Water - Controlled\$4200, Incomer - All\$4199, Kitchen Appliances\$4201,
Laundry\$4202, Lighting\$4203 & Heat Pump\$4211, Incomer - All\$4213,
Kitchen Appliances\$4210, Laundry, Garage \& Guest Bed\$4215,
Lighting\$4212, Oven\$4214 & Heat Pump\$4219, Incomer - All\$4221,
Kitchen Appliances\$4216, Laundry\$4217, Lighting\$4218, PV \&
Garage\$4220 & Heat Pump\$4223, Hot Water - Uncontrolled\$4224, Incomer
- All\$4225, Kitchen Appliances\$4226, Laundry \& Garage Freezer\$4227,
Lighting\$4222 & Heat Pumps (2x) \& Power\_Imag\$4399, Heat Pumps (2x)
\& Power\$4232, Hot Water - Controlled\_Imag\$4400, Hot Water -
Controlled\$4231, Incomer - Uncontrolled\_Imag\$4401, Incomer -
Uncontrolled\$4230, Incomer Voltage\$4405, Kitchen \&
Bedrooms\_Imag\$4402, Kitchen \& Bedrooms\$4229, Laundry \&
Bedrooms\_Imag\$4403, Laundry \& Bedrooms\$4228, Lighting\_Imag\$4404,
Lighting\$4233 & Heat Pumps (2x) \& Power\$4232, Heat Pumps (2x) \&
Power\$4399, Hot Water - Controlled\$4231, Hot Water - Controlled\$4400,
Incomer - Uncontrolled\$4230, Incomer - Uncontrolled\$4401, Incomer
Voltage\$4405, Kitchen \& Bedrooms\$4229, Kitchen \& Bedrooms\$4402,
Laundry \& Bedrooms\$4228, Laundry \& Bedrooms\$4403, Lighting\$4233,
Lighting\$4404 & Heat Pumps (2x) \& Power1\$4232, Heat Pumps (2x) \&
Power2\$4399, Hot Water - Controlled1\$4231, Hot Water -
Controlled2\$4400, Incomer - Uncontrolled1\$4230, Incomer -
Uncontrolled2\$4401, Incomer Voltage\$4405, Kitchen \& Bedrooms1\$4229,
Kitchen \& Bedrooms2\$4402, Laundry \& Bedrooms1\$4228, Laundry \&
Bedrooms2\$4403, Lighting1\$4233, Lighting2\$4404 & Heating\$1633, Hot
water\$1636, Kitchen power\$1632, Lights\$1635, Mains\$1634, Range\$1637
& Hob\$3954, Hot Water\$3952, Incomer 1\$3956, Incomer 2\$3955, Laundry
\& Kitchen Appliances\$3951, Oven\$3953 & Hot Water (2 elements)\$4247,
Incomer - Uncontrolled\$4248, Kitchen Appliances\$4244, Lighting \& 2
Towel Rail\$4245, Oven\$4246 & Hot Water - Controlled (HEMS)\$2081,
Incomer - Uncontrolled\$2082, Kitchen, Laundry \& Ventilation\$2084,
Oven\$2085, PV \& Storage\$2083, Spa (HEMS)\$2080 & Hot Water -
Controlled\$2102, Incomer - Uncontrolled\$2101, Kitchen\$2104, Laundry,
Fridge \& Freezer\$2105, Oven \& Hob\$2103, PV\$2106 & Hot Water -
Controlled\$2129, Incomer 1 - Uncontrolled\$2128, Incomer 2 -
Uncontrolled\$2130, Kitchen Appliances \& Ventilati\$2131, Laundry \&
Hob\$2133, Oven\$2132 & Hot Water - Controlled\$2236, Incomer -
Uncontrolled\$2237, Kitchen \& Laundry\$2234, Lighting\$2232,
Oven\$2235, Ventilation \& Lounge Power\$2233 & Hot Water -
Controlled\$2248, Incomer - Uncontrolled\$2249, Kitchen\$2246, Laundry,
Downstairs \& Lounge\$2245, Lighting\$2244, Oven \& Hob\$2247 & Hot
Water - Controlled\$2719, Incomer 1 - Uncont inc Stove\$2718, Incomer 2
- Uncont inc Oven\$2717, Kitchen Appliances\$2715, Laundry \&
Microwave\$2720, Power Outlets\$2716 & Hot Water - Controlled\$4144,
Incomer - Uncontrolled\$4143, Kitchen Appliances \& Heat Pump\$4140,
Laundry \& Teenagers Bedroom\$4139, Lighting\$4142, Oven, Hob \&
Microwave\$4141 & Hot Water - Controlled\$4238, Incomer - All\$4239,
Kitchen Appliances\$4234, Laundry \& Kitchen\$4235, Lighting\$4236, Oven
\& Hobb\$4237 & Incomer 1 - All\$2703, Incomer 2 - All\$2704, Kitchen
Appliances\$2706, Laundry, Sauna \& 2nd Fridge\$2707, Oven\$2705,
Spa\$2708 & Incomer 1 - Hot Water - Cont\$2626, Incomer 2 -
Uncontrolled\$2625, Incomer 3 - Uncontrolled\$2627, Kitchen Appliances
\& Lounge\$2630, Laundry, Fridge \& Microwave\$2628, Oven\$2629 &
Incomer 1 - inc Top Oven\$5620, Incomer 2 - inc Bottom Oven\$5621,
Kitchen Appliances\$5625, Laundry \& Garage\$5624, Lighting 1/2\$5623,
Lighting 2/2\$5622 & Incomer 1 - Uncontrolled\$2726, Incomer 2 -
Uncontrolled\$2725, Kitchen Appliances \& Laundry\$2722,
Microwave\$2721, Oven\$2724, Workshop\$2723\tabularnewline
\midrule
\endhead
rf\_01 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 3 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_02 & 0 & 0 & 0 & 3 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_06 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 186 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_07 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 186\tabularnewline
rf\_08 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 5 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_09 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 2 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_10 & 0 & 0 & 358 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_11 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 488 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_12 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 2 & 0 & 0\tabularnewline
rf\_13 & 0 & 0 & 0 & 0 & 420 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_14 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 329 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_15 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
2 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_16 & 0 & 0 & 0 & 0 & 0 & 0 & 1 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_17 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 2 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 202 & 0\tabularnewline
rf\_18 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 2 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_19 & 0 & 488 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_20 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 2 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_21 & 0 & 0 & 0 & 0 & 0 & 4 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_22 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 371 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_23 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 488 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_24 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 488 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_25 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 1 &
2 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_26 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 394 & 0 & 0 & 0\tabularnewline
rf\_27 & 3 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_28 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 2 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_29 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 485 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_30 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 5 & 0 & 0 & 0 & 0\tabularnewline
rf\_31 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 488 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_32 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 2 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_33 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 487 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_34 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 7 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_35 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 134 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_36 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 438 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_37 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 487 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_38 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 201 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_39 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 364 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_40 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 2 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_41 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 479 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_42 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 45 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_43 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 4 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_44 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 488 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_45 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 4 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_46 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 2 & 408 & 1 & 0
& 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
rf\_47 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 3 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 &
0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0 & 0\tabularnewline
\bottomrule
\end{longtable}

If this is not the case then this implies that:

\begin{itemize}
\tightlist
\item
  some of the circuit labels for these households may have been changed
  during the data collection process;
\item
  some of the circuit labels may have character conversion errors which
  have changed the labels during the data collection process;
\item
  at least one file from one household has been saved to a folder
  containing data from a different household (unfortunately the raw data
  files do \emph{not} contain household IDs in the data or the file
  names which would enable checking/preventative filtering). This will
  be visible in the table if two households appear to share
  \emph{exactly} the same list of circuit labels.
\end{itemize}

Some or all of these may be true at any given time!

Errors are easy to spot in the following plot where a hhID spans 2 or
more circuit labels.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{t <-}\StringTok{ }\NormalTok{fListCompleteDT[}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(circuitLabels), .(}\DataTypeTok{nFiles =}\NormalTok{ .N,}
                                              \DataTypeTok{minObsDate =} \KeywordTok{min}\NormalTok{(obsStartDate), }\CommentTok{# helps locate issues in data}
                                              \DataTypeTok{maxObsDate =} \KeywordTok{max}\NormalTok{(obsEndDate),}
                                              \DataTypeTok{minFileDate =} \KeywordTok{min}\NormalTok{(fMDate), }\CommentTok{# helps locate issues in files}
                                              \DataTypeTok{maxFileDate =} \KeywordTok{max}\NormalTok{(fMDate),}
                                              \DataTypeTok{nObs =} \KeywordTok{sum}\NormalTok{(nObs)),}
\NormalTok{                     keyby =}\StringTok{ }\NormalTok{.(circuitLabels, hhID)] }\CommentTok{# ignore NA - it is files not loaded due to size thresholds}

\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggplot}\NormalTok{(t, }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{y =}\NormalTok{ hhID, }\DataTypeTok{x =}\NormalTok{ circuitLabels, }\DataTypeTok{fill =}\NormalTok{ nObs)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_tile}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\CommentTok{#theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 0.5)) + }
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \StringTok{"Circuit label counts for all loaded grid spy data"}\NormalTok{,}
       \DataTypeTok{caption =} \KeywordTok{paste0}\NormalTok{(myCaption,}
                        \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Only files of size > "}\NormalTok{, dataThreshold, }\StringTok{" bytes loaded"}\NormalTok{)}
       
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\includegraphics{processNZGGElecCons1minData_files/figure-html/plotCircuitLabelIssuesAsTile-1.png}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggsave}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(outPath, }\StringTok{"gridSpyLoadedFileCircuitLabelsPlot.png"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Saving 7 x 8 in image
\end{verbatim}

The following table provides more detail to aid error checking. Check
for:

\begin{itemize}
\tightlist
\item
  2+ adjacent rows which have exactly the same circuit labels but
  different hh\_ids. This implies some data from one household has been
  saved in the wrong folder;
\item
  2+ adjacent rows which have different circuit labels but identical
  hh\_ids. This could imply the same thing but is more likely to be
  errors/changes to the circuit labelling.
\end{itemize}

If the above plot and this table flag a lot of errors then some
re-naming of the circuit labels (column names) may be necessary.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\DataTypeTok{caption =} \StringTok{"Circuit labels by household with addiitonal meta-data"}\NormalTok{, t)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}llrllllr@{}}
\caption{Circuit labels by household with addiitonal
meta-data}\tabularnewline
\toprule
circuitLabels & hhID & nFiles & minObsDate & maxObsDate & minFileDate &
maxFileDate & nObs\tabularnewline
\midrule
\endfirsthead
\toprule
circuitLabels & hhID & nFiles & minObsDate & maxObsDate & minFileDate &
maxFileDate & nObs\tabularnewline
\midrule
\endhead
Bed 2, 2nd Fridge\$2828, Heat Pump\$2826, Hot Water - Controlled\$2825,
Incomer - Uncontrolled\$2824, Kitchen, Laundry \& Beds 1\&3\$2829, Oven
\& Oven Wall Appliances\$2827 & rf\_27 & 3 & 2014-07-27 & 2016-05-13 &
2016-05-25 & 2016-09-21 & 1419097\tabularnewline
Bedroom \& Lounge Heat Pumps\$2741, Incomer 1 - All\$2738, Incomer 2 -
All\$2737, Kitchen Appliances\$2735, Laundry\$2734, Oven\$2736, PV
1\$2739, PV 2\$2733, Theatre Heat Pump\$2740 & rf\_19 & 488 & 2014-07-14
& 2018-05-08 & 2016-05-25 & 2018-05-08 & 4115666\tabularnewline
Bedrooms \& Lounge\$2602, Heat Pump\$2598, Incomer - All\$2599, Kitchen
Appliances\$2601, Laundry \& Garage\$2597, Oven\$2600 & rf\_10 & 358 &
2014-07-08 & 2018-03-29 & 2016-05-25 & 2018-03-30 &
3734792\tabularnewline
Cooking Bath tile heat\$1573, Fridge\$1572, Heating\$1576, Hot
Water\$1574, Lights\$1577, Mains\$1575 & rf\_02 & 3 & 2014-03-02 &
2015-05-28 & 2016-09-20 & 2016-09-30 & 592592\tabularnewline
Downstairs (inc 1 Heat Pump)\$2212, Hot Water - Controlled\$2208,
Incomer - Uncontrolled\$2209, Kitchen \& Laundry\$2213, Oven \&
Hob\$2210, Upstairs Heat Pumps\$2211 & rf\_13 & 420 & 2014-06-05 &
2018-05-08 & 2016-05-25 & 2018-05-08 & 3838753\tabularnewline
Fridge\$2752, Heat Pump \& Washing Machine\$2750, Incomer - All\$2748,
Kitchen Appliances \& Garage\$2753, Lower Bedrooms \& Bathrooms\$2751,
Oven\$2749 & rf\_21 & 4 & 2014-07-14 & 2016-07-01 & 2016-05-25 &
2016-10-12 & 1972512\tabularnewline
Hallway \& Washing Machine\$2683, Hot Water - Controlled\$2679, Incomer
1 - Uncont inc Oven\$2681, Incomer 2 - Uncont inc Stove\$2680, Kitchen
Appliances \& Bedrooms\$2684, Microwave \& Breadmaker\$2682 & rf\_16 & 1
& 2014-07-09 & 2015-03-25 & 2016-09-20 & 2016-09-20 &
373523\tabularnewline
Heat Pump \& 2 x Bathroom Heat\$4171, Incomer - All\$4170, Kitchen Power
\& Heat, Lounge\$4174, Laundry, Garage \& 2 Bedrooms\$4173,
Lighting\$4172, Wall Oven\$4169 & rf\_47 & 3 & 2015-03-24 & 2016-05-08 &
2016-05-25 & 2016-09-20 & 1180942\tabularnewline
Heat Pump \& Bedroom 2\$2731, Incomer 1 - Uncont - Inc Hob\$2729,
Incomer 2 - Uncont - Inc Oven\$2730, Kitchen Appliances\$2727,
Laundry\$2732, Lounge, Dining \& Bedrooms\$2728 & rf\_09 & 2 &
2014-07-13 & 2015-07-16 & 2016-09-21 & 2016-09-21 &
529363\tabularnewline
Heat Pump \& Kitchen Appliances\$4186, Hot Water - Controlled\$4184,
Incomer - Uncontrolled\$4181, Laundry\$4185, Lighting\$4183, Oven\$4182
& rf\_29 & 485 & 2015-03-25 & 2018-05-08 & 2016-05-25 & 2018-05-08 &
3230551\tabularnewline
Heat Pump \& Lounge\$2590, Hob\$2589, Hot Water Cpbd Heater- Cont\$2586,
Incomer - Uncontrolled\$2585, Kitchen Appliances \& Laundry\$2588, Spa -
Uncontrolled\$2587 & rf\_11 & 488 & 2014-07-07 & 2018-05-08 & 2016-05-25
& 2018-05-08 & 4132333\tabularnewline
Heat Pump \& Misc\$2107, Hob\$2109, Hot Water - Controlled\$2110,
Incomer 1 - Uncontrolled\$2112, Incomer 2 - Uncontrolled\$2111, Oven \&
Kitchen Appliances\$2108 & rf\_20 & 2 & 2014-05-28 & 2015-06-11 &
2016-09-21 & 2016-09-21 & 545138\tabularnewline
Heat Pump (x2) \& Lounge Power\$4166, Hot Water - Controlled\$4167,
Incomer - Uncontrolled\$4168, Kitchen Appliances\$4163, Laundry\$4164,
Lighting\$4165 & rf\_40 & 2 & 2015-03-24 & 2015-11-22 & 2016-06-08 &
2016-09-20 & 349528\tabularnewline
Heat Pump\$2092, Hot Water - Controlled\$2094, Incomer -
Uncontrolled\$2093, Kitchen\$2089, Laundry \& 2nd Fridge Freezer\$2090,
Oven \& Hob\$2091 & rf\_08 & 5 & 2014-05-28 & 2017-05-15 & 2016-05-25 &
2017-11-21 & 2536195\tabularnewline
Heat Pump\$2148, Hot Water - Controlled\$2150, Incomer 1 - Uncont - inc
Hob\$2152, Incomer 2 - Uncont - inc Oven\$2151, Kitchen
Appliances\$2147, Laundry\$2149 & rf\_17 & 2 & 2014-05-29 & 2016-03-28 &
2016-09-21 & 2016-09-21 & 962873\tabularnewline
Heat Pump\$2758, Hob \& Kitchen Appliances\$2759, Hot Water -
Controlled\$2761, Incomer 1 - Uncontrolled \$2763, Incomer 1 -
Uncontrolled\$2757, Incomer 2 - Uncontrolled \$2762, Oven\$2760 & rf\_25
& 1 & 2015-05-24 & 2016-05-25 & 2016-06-08 & 2016-06-08 &
507847\tabularnewline
Heat Pump\$2758, Hob \& Kitchen Appliances\$2759, Hot Water -
Controlled\$2761, Incomer 1 - Uncontrolled \$2763, Incomer 2 -
Uncontrolled \$2762, Oven\$2760 & rf\_25 & 2 & 2016-05-25 & 2016-10-22 &
2016-10-25 & 2017-11-21 & 213418\tabularnewline
Heat Pump\$4124, Hot Water - Uncontrolled\$4125, Incomer -
Uncontrolled\$4126, Kitchen Appliances\$4121, Laundry, Garage Fridge
Freezer\$4122, Lighting\$4123 & rf\_35 & 134 & 2015-03-22 & 2017-05-17 &
2016-05-25 & 2017-11-21 & 1494089\tabularnewline
Heat Pump\$4130, Hot Water - Uncontrolled\$4131, Incomer - All\$4132,
Kitchen Appliances\$4127, Laundry \& Freezer\$4128, Lighting (inc heat
lamps)\$4129 & rf\_42 & 45 & 2015-03-23 & 2017-02-18 & 2016-06-08 &
2017-11-21 & 1099072\tabularnewline
Heat Pump\$4134, Hot Water - Controlled\$4135, Incomer
-Uncontrolled\$4136, Kitchen Appliances\$4137, Laundry \& Fridge
Freezer\$4138, Lighting\$4133 & rf\_37 & 487 & 2015-03-23 & 2018-05-08 &
2016-06-08 & 2018-05-08 & 2792074\tabularnewline
Heat Pump\$4150, Hot Water - Uncontrolled\$4147, Incomer - All\$4148,
Kitchen Appliances\$4145, Lighting\$4149, Washing Machine\$4146 & rf\_36
& 438 & 2015-03-23 & 2018-05-08 & 2016-06-08 & 2018-05-08 &
2618000\tabularnewline
Heat Pump\$4154, Hot Water - Controlled\$4155, Incomer -
Uncontrolled\$4156, Kitchen Appliances\$4151, Laundry \$4152,
Lighting\$4153 & rf\_44 & 488 & 2015-03-24 & 2018-05-08 & 2016-05-25 &
2018-05-08 & 3406521\tabularnewline
Heat Pump\$4160, Hot Water - Controlled\$4158, Incomer -
Uncontrolled\$4157, Kitchen Appliances\$4161, Laundry \& Garage
Fridge\$4162, Lighting\$4159 & rf\_45 & 4 & 2015-03-24 & 2016-10-15 &
2016-06-08 & 2017-11-21 & 821472\tabularnewline
Heat Pump\$4175, Hot Water - Controlled\$4178, Incomer -
Uncontrolled\$4177, Kitchen, Dining \& Office\$4179, Laundry, Lounge,
Garage, Bed\$4180, Lighting\$4176 & rf\_38 & 201 & 2015-03-24 &
2017-08-22 & 2016-06-08 & 2017-11-21 & 1456669\tabularnewline
Heat Pump\$4190, Incomer - All\$4192, Kitchen Appliances\$4187,
Laundry\$4188, Lighting\$4189, Oven\$4191 & rf\_41 & 479 & 2015-03-25 &
2018-05-08 & 2016-06-08 & 2018-05-08 & 2384583\tabularnewline
Heat Pump\$4196, Hot Water - Controlled\$4198, Incomer - All\$4193,
Kitchen Appliances\$4195, Laundry\$4194, Lighting\$4197 & rf\_32 & 2 &
2015-03-25 & 2016-04-05 & 2016-06-08 & 2016-09-20 &
542484\tabularnewline
Heat Pump\$4204, Hot Water - Controlled\$4200, Incomer - All\$4199,
Kitchen Appliances\$4201, Laundry\$4202, Lighting\$4203 & rf\_31 & 488 &
2015-03-25 & 2018-05-08 & 2016-05-25 & 2018-05-08 &
3402121\tabularnewline
Heat Pump\$4211, Incomer - All\$4213, Kitchen Appliances\$4210, Laundry,
Garage \& Guest Bed\$4215, Lighting\$4212, Oven\$4214 & rf\_43 & 4 &
2015-03-26 & 2015-10-18 & 2016-05-25 & 2016-09-28 &
890700\tabularnewline
Heat Pump\$4219, Incomer - All\$4221, Kitchen Appliances\$4216,
Laundry\$4217, Lighting\$4218, PV \& Garage\$4220 & rf\_28 & 2 &
2015-03-26 & 2015-05-26 & 2016-06-08 & 2016-09-19 & 87417\tabularnewline
Heat Pump\$4223, Hot Water - Uncontrolled\$4224, Incomer - All\$4225,
Kitchen Appliances\$4226, Laundry \& Garage Freezer\$4227,
Lighting\$4222 & rf\_34 & 7 & 2014-11-03 & 2016-08-24 & 2016-05-25 &
2016-10-13 & 2066074\tabularnewline
Heat Pumps (2x) \& Power\$4232, Heat Pumps (2x) \& Power\$4399, Hot
Water - Controlled\$4231, Hot Water - Controlled\$4400, Incomer -
Uncontrolled\$4230, Incomer - Uncontrolled\$4401, Incomer Voltage\$4405,
Kitchen \& Bedrooms\$4229, Kitchen \& Bedrooms\$4402, Laundry \&
Bedrooms\$4228, Laundry \& Bedrooms\$4403, Lighting\$4233,
Lighting\$4404 & rf\_46 & 408 & 2015-05-24 & 2018-02-19 & 2016-06-08 &
2018-02-21 & 1684742\tabularnewline
Heat Pumps (2x) \& Power1\$4232, Heat Pumps (2x) \& Power2\$4399, Hot
Water - Controlled1\$4231, Hot Water - Controlled2\$4400, Incomer -
Uncontrolled1\$4230, Incomer - Uncontrolled2\$4401, Incomer
Voltage\$4405, Kitchen \& Bedrooms1\$4229, Kitchen \& Bedrooms2\$4402,
Laundry \& Bedrooms1\$4228, Laundry \& Bedrooms2\$4403, Lighting1\$4233,
Lighting2\$4404 & rf\_46 & 1 & 2016-10-11 & 2017-11-20 & 2017-11-21 &
2017-11-21 & 582988\tabularnewline
Heat Pumps (2x) \& Power\_Imag\$4399, Heat Pumps (2x) \& Power\$4232,
Hot Water - Controlled\_Imag\$4400, Hot Water - Controlled\$4231,
Incomer - Uncontrolled\_Imag\$4401, Incomer - Uncontrolled\$4230,
Incomer Voltage\$4405, Kitchen \& Bedrooms\_Imag\$4402, Kitchen \&
Bedrooms\$4229, Laundry \& Bedrooms\_Imag\$4403, Laundry \&
Bedrooms\$4228, Lighting\_Imag\$4404, Lighting\$4233 & rf\_46 & 2 &
2015-03-26 & 2016-10-11 & 2016-09-29 & 2016-10-25 &
261377\tabularnewline
Heating\$1633, Hot water\$1636, Kitchen power\$1632, Lights\$1635,
Mains\$1634, Range\$1637 & rf\_01 & 3 & 2014-01-05 & 2015-10-20 &
2016-09-20 & 2016-09-30 & 855836\tabularnewline
Hob\$3954, Hot Water\$3952, Incomer 1\$3956, Incomer 2\$3955, Laundry \&
Kitchen Appliances\$3951, Oven\$3953 & rf\_15 & 2 & 2015-01-14 &
2016-04-18 & 2016-09-21 & 2016-09-21 & 395011\tabularnewline
Hot Water (2 elements)\$4247, Incomer - Uncontrolled\$4248, Kitchen
Appliances\$4244, Lighting \& 2 Towel Rail\$4245, Oven\$4246 & rf\_39 &
364 & 2015-03-27 & 2018-05-08 & 2016-05-25 & 2018-05-08 &
2957170\tabularnewline
Hot Water - Controlled (HEMS)\$2081, Incomer - Uncontrolled\$2082,
Kitchen, Laundry \& Ventilation\$2084, Oven\$2085, PV \& Storage\$2083,
Spa (HEMS)\$2080 & rf\_23 & 488 & 2014-05-25 & 2018-05-08 & 2016-05-25 &
2018-05-08 & 4195622\tabularnewline
Hot Water - Controlled\$2102, Incomer - Uncontrolled\$2101,
Kitchen\$2104, Laundry, Fridge \& Freezer\$2105, Oven \& Hob\$2103,
PV\$2106 & rf\_24 & 488 & 2014-05-28 & 2018-05-08 & 2016-05-25 &
2018-05-08 & 4146391\tabularnewline
Hot Water - Controlled\$2129, Incomer 1 - Uncontrolled\$2128, Incomer 2
- Uncontrolled\$2130, Kitchen Appliances \& Ventilati\$2131, Laundry \&
Hob\$2133, Oven\$2132 & rf\_18 & 2 & 2014-05-29 & 2015-06-11 &
2016-09-21 & 2016-09-21 & 543098\tabularnewline
Hot Water - Controlled\$2236, Incomer - Uncontrolled\$2237, Kitchen \&
Laundry\$2234, Lighting\$2232, Oven\$2235, Ventilation \& Lounge
Power\$2233 & rf\_22 & 371 & 2014-06-05 & 2018-01-14 & 2016-05-25 &
2018-01-16 & 3837181\tabularnewline
Hot Water - Controlled\$2248, Incomer - Uncontrolled\$2249,
Kitchen\$2246, Laundry, Downstairs \& Lounge\$2245, Lighting\$2244, Oven
\& Hob\$2247 & rf\_06 & 186 & 2014-06-08 & 2018-05-08 & 2016-05-25 &
2018-05-08 & 2907116\tabularnewline
Hot Water - Controlled\$2719, Incomer 1 - Uncont inc Stove\$2718,
Incomer 2 - Uncont inc Oven\$2717, Kitchen Appliances\$2715, Laundry \&
Microwave\$2720, Power Outlets\$2716 & rf\_14 & 329 & 2014-07-13 &
2017-12-30 & 2016-06-08 & 2017-12-31 & 2654180\tabularnewline
Hot Water - Controlled\$4144, Incomer - Uncontrolled\$4143, Kitchen
Appliances \& Heat Pump\$4140, Laundry \& Teenagers Bedroom\$4139,
Lighting\$4142, Oven, Hob \& Microwave\$4141 & rf\_33 & 487 & 2015-03-23
& 2018-05-08 & 2016-06-08 & 2018-05-08 & 2692342\tabularnewline
Hot Water - Controlled\$4238, Incomer - All\$4239, Kitchen
Appliances\$4234, Laundry \& Kitchen\$4235, Lighting\$4236, Oven \&
Hobb\$4237 & rf\_30 & 5 & 2015-03-27 & 2016-09-29 & 2016-05-25 &
2016-10-13 & 1454037\tabularnewline
Incomer 1 - All\$2703, Incomer 2 - All\$2704, Kitchen Appliances\$2706,
Laundry, Sauna \& 2nd Fridge\$2707, Oven\$2705, Spa\$2708 & rf\_26 & 394
& 2014-07-10 & 2018-05-08 & 2016-05-25 & 2018-05-08 &
3181536\tabularnewline
Incomer 1 - Hot Water - Cont\$2626, Incomer 2 - Uncontrolled\$2625,
Incomer 3 - Uncontrolled\$2627, Kitchen Appliances \& Lounge\$2630,
Laundry, Fridge \& Microwave\$2628, Oven\$2629 & rf\_12 & 2 & 2014-07-08
& 2015-06-02 & 2016-09-21 & 2016-09-21 & 410063\tabularnewline
Incomer 1 - Uncontrolled\$2726, Incomer 2 - Uncontrolled\$2725, Kitchen
Appliances \& Laundry\$2722, Microwave\$2721, Oven\$2724, Workshop\$2723
& rf\_07 & 186 & 2014-07-13 & 2018-05-08 & 2016-05-25 & 2018-05-08 &
3158849\tabularnewline
Incomer 1 - inc Top Oven\$5620, Incomer 2 - inc Bottom Oven\$5621,
Kitchen Appliances\$5625, Laundry \& Garage\$5624, Lighting 1/2\$5623,
Lighting 2/2\$5622 & rf\_17 & 202 & 2016-10-11 & 2018-05-05 & 2017-01-11
& 2018-05-06 & 753820\tabularnewline
\bottomrule
\end{longtable}

\subsection{Observations}\label{observations}

The following plots show the number of observations per day per
household. In theory we should not see:

\begin{itemize}
\tightlist
\item
  dates before 2014 or in to the future. These may indicate:

  \begin{itemize}
  \tightlist
  \item
    date conversion errors;
  \end{itemize}
\item
  more than 1440 observations per day. These may indicate:

  \begin{itemize}
  \tightlist
  \item
    duplicate time stamps - i.e.~they have the same time stamps but
    different power (W) values or different circuit labels;
  \item
    observations from files that are in the `wrong' rf\_XX folder and so
    are included in the `wrong' household as `duplicate' time stamps.
  \end{itemize}
\end{itemize}

If present both of the latter may have been implied by the table above
and would have evaded the de-duplication filter which simply checks each
complete row against all others within it's consolidated household
dataset (a \emph{within household absolute duplicate} check).

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# short cut if already generated}
\CommentTok{# hhStatDT <- as.data.table(read_csv(ofile)) # parses dates}

\CommentTok{# tile plot ----}
\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggplot}\NormalTok{(hhStatDT, }\KeywordTok{aes}\NormalTok{( }\DataTypeTok{x =}\NormalTok{ date, }\DataTypeTok{y =}\NormalTok{ hhID, }\DataTypeTok{fill =}\NormalTok{ nObs)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_tile}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_fill_gradient}\NormalTok{(}\DataTypeTok{low =} \StringTok{"red"}\NormalTok{, }\DataTypeTok{high =} \StringTok{"green"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_x_date}\NormalTok{(}\DataTypeTok{date_labels =} \StringTok{"%Y %b"}\NormalTok{, }\DataTypeTok{date_breaks =} \StringTok{"6 months"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{90}\NormalTok{, }\DataTypeTok{vjust =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{hjust =} \FloatTok{0.5}\NormalTok{)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \StringTok{"N observations per household per day for all loaded grid spy data"}\NormalTok{,}
       \DataTypeTok{caption =} \KeywordTok{paste0}\NormalTok{(myCaption,}
                        \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Only files of size > "}\NormalTok{, dataThreshold, }\StringTok{" bytes loaded"}\NormalTok{)}
       
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\includegraphics{processNZGGElecCons1minData_files/figure-html/loadedFilesObsPlots-1.png}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggsave}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(outPath, }\StringTok{"gridSpyLoadedFileNobsTilePlot.png"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Saving 7 x 5 in image
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# point plot ----}
\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggplot}\NormalTok{(hhStatDT, }\KeywordTok{aes}\NormalTok{( }\DataTypeTok{x =}\NormalTok{ date, }\DataTypeTok{y =}\NormalTok{ nObs, }\DataTypeTok{colour =}\NormalTok{ hhID)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_x_date}\NormalTok{(}\DataTypeTok{date_labels =} \StringTok{"%Y %b"}\NormalTok{, }\DataTypeTok{date_breaks =} \StringTok{"6 months"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{90}\NormalTok{, }\DataTypeTok{vjust =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{hjust =} \FloatTok{0.5}\NormalTok{)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \StringTok{"N observations per household per day for all loaded grid spy data"}\NormalTok{,}
       \DataTypeTok{caption =} \KeywordTok{paste0}\NormalTok{(myCaption,}
                        \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Only files of size > "}\NormalTok{, dataThreshold, }\StringTok{" bytes loaded"}\NormalTok{)}
       
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\includegraphics{processNZGGElecCons1minData_files/figure-html/loadedFilesObsPlots-2.png}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggsave}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(outPath, }\StringTok{"gridSpyLoadedFileNobsPointPlot.png"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Saving 7 x 5 in image
\end{verbatim}

The following table shows the min/max observations per day and min/max
dates for each household. As above, we should not see:

\begin{itemize}
\tightlist
\item
  dates before 2014 or in to the future (indicates date conversion
  errors)
\item
  more than 1440 observations per day (indicates potentially duplicate
  observations)
\item
  non-integer counts of circuits as it suggests some column errors
\end{itemize}

We should also not see NA in any row (indicates date conversion errors).

If we do see any of these then we still have data cleaning work to do!

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Stats table (so we can pick out the dateTime errors)}
\NormalTok{t <-}\StringTok{ }\NormalTok{hhStatDT[, .(}\DataTypeTok{minObs =} \KeywordTok{min}\NormalTok{(nObs),}
             \DataTypeTok{maxObs =} \KeywordTok{max}\NormalTok{(nObs), }\CommentTok{# should not be more than 1440, if so suggests duplicates}
             \DataTypeTok{meanNDataColumns =}\KeywordTok{mean}\NormalTok{(nDataColumns), }\CommentTok{#i.e. n circuits}
             \DataTypeTok{minDate =} \KeywordTok{min}\NormalTok{(date),}
             \DataTypeTok{maxDate =} \KeywordTok{max}\NormalTok{(date)),}
\NormalTok{         keyby =}\StringTok{ }\NormalTok{.(hhID)]}

\NormalTok{knitr}\OperatorTok{::}\KeywordTok{kable}\NormalTok{(}\DataTypeTok{caption =} \StringTok{"Summary observation stats by hhID"}\NormalTok{, t)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}lrrrll@{}}
\caption{Summary observation stats by hhID}\tabularnewline
\toprule
hhID & minObs & maxObs & meanNDataColumns & minDate &
maxDate\tabularnewline
\midrule
\endfirsthead
\toprule
hhID & minObs & maxObs & meanNDataColumns & minDate &
maxDate\tabularnewline
\midrule
\endhead
rf\_01 & 171 & 1500 & 6 & 2014-01-05 & 2015-10-20\tabularnewline
rf\_02 & 215 & 1440 & 6 & 2014-03-02 & 2015-05-28\tabularnewline
rf\_06 & 243 & 1500 & 6 & 2014-06-08 & 2018-05-08\tabularnewline
rf\_07 & 105 & 1500 & 6 & 2014-07-13 & 2018-05-08\tabularnewline
rf\_08 & 123 & 1500 & 6 & 2014-05-28 & 2017-05-15\tabularnewline
rf\_09 & 163 & 1500 & 6 & 2014-07-13 & 2015-07-16\tabularnewline
rf\_10 & 389 & 1500 & 6 & 2014-07-08 & 2018-03-29\tabularnewline
rf\_11 & 278 & 1500 & 6 & 2014-07-07 & 2018-05-08\tabularnewline
rf\_12 & 85 & 1500 & 6 & 2014-07-08 & 2015-06-02\tabularnewline
rf\_13 & 456 & 1500 & 6 & 2014-06-05 & 2018-05-08\tabularnewline
rf\_14 & 120 & 1500 & 6 & 2014-07-13 & 2017-12-30\tabularnewline
rf\_15 & 62 & 1440 & 6 & 2015-01-14 & 2016-04-18\tabularnewline
rf\_16 & 720 & 1500 & 6 & 2014-07-09 & 2015-03-25\tabularnewline
rf\_17 & 22 & 1500 & 6 & 2014-05-29 & 2018-05-05\tabularnewline
rf\_18 & 157 & 1500 & 6 & 2014-05-29 & 2015-06-11\tabularnewline
rf\_19 & 387 & 1500 & 9 & 2014-07-14 & 2018-05-08\tabularnewline
rf\_20 & 98 & 1500 & 6 & 2014-05-28 & 2015-06-11\tabularnewline
rf\_21 & 195 & 1500 & 6 & 2014-07-14 & 2016-07-01\tabularnewline
rf\_22 & 6 & 1500 & 6 & 2014-06-05 & 2018-01-14\tabularnewline
rf\_23 & 171 & 1500 & 6 & 2014-05-25 & 2018-05-08\tabularnewline
rf\_24 & 571 & 1500 & 6 & 2014-05-28 & 2018-05-08\tabularnewline
rf\_25 & 45 & 1500 & 6 & 2015-05-24 & 2016-10-22\tabularnewline
rf\_26 & 362 & 2231 & 6 & 2014-07-10 & 2018-05-08\tabularnewline
rf\_27 & 567 & 1560 & 6 & 2014-07-27 & 2016-05-13\tabularnewline
rf\_28 & 297 & 1440 & 6 & 2015-03-26 & 2015-05-26\tabularnewline
rf\_29 & 720 & 1500 & 6 & 2015-03-25 & 2018-05-08\tabularnewline
rf\_30 & 205 & 1500 & 6 & 2015-03-27 & 2016-09-29\tabularnewline
rf\_31 & 720 & 1500 & 6 & 2015-03-25 & 2018-05-08\tabularnewline
rf\_32 & 325 & 1500 & 6 & 2015-03-25 & 2016-04-05\tabularnewline
rf\_33 & 369 & 1500 & 6 & 2015-03-23 & 2018-05-08\tabularnewline
rf\_34 & 317 & 1500 & 6 & 2014-11-03 & 2016-08-24\tabularnewline
rf\_35 & 50 & 1500 & 6 & 2015-03-22 & 2017-05-17\tabularnewline
rf\_36 & 29 & 1500 & 6 & 2015-03-23 & 2018-05-08\tabularnewline
rf\_37 & 720 & 1500 & 6 & 2015-03-23 & 2018-05-08\tabularnewline
rf\_38 & 398 & 1500 & 6 & 2015-03-24 & 2017-08-22\tabularnewline
rf\_39 & 163 & 1823 & 5 & 2015-03-27 & 2018-05-08\tabularnewline
rf\_40 & 268 & 1500 & 6 & 2015-03-24 & 2015-11-22\tabularnewline
rf\_41 & 1 & 1573 & 6 & 2015-03-25 & 2018-05-08\tabularnewline
rf\_42 & 79 & 1500 & 6 & 2015-03-23 & 2017-02-18\tabularnewline
rf\_43 & 780 & 1495 & 6 & 2015-03-26 & 2015-10-18\tabularnewline
rf\_44 & 720 & 1500 & 6 & 2015-03-24 & 2018-05-08\tabularnewline
rf\_45 & 69 & 1499 & 6 & 2015-03-24 & 2016-10-15\tabularnewline
rf\_46 & 305 & 3000 & 13 & 2015-03-26 & 2018-02-19\tabularnewline
rf\_47 & 159 & 1500 & 6 & 2015-03-24 & 2016-05-08\tabularnewline
\bottomrule
\end{longtable}

Finally we show the total number of households which we think are still
sending data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{plotDT <-}\StringTok{ }\NormalTok{hhStatDT[, .(}\DataTypeTok{nHH =} \KeywordTok{uniqueN}\NormalTok{(hhID)), keyby =}\StringTok{ }\NormalTok{.(date)]}

\CommentTok{# point plot ----}
\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggplot}\NormalTok{(plotDT, }\KeywordTok{aes}\NormalTok{( }\DataTypeTok{x =}\NormalTok{ date, }\DataTypeTok{y =}\NormalTok{ nHH)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_x_date}\NormalTok{(}\DataTypeTok{date_labels =} \StringTok{"%Y %b"}\NormalTok{, }\DataTypeTok{date_breaks =} \StringTok{"6 months"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{angle =} \DecValTok{90}\NormalTok{, }\DataTypeTok{vjust =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{hjust =} \FloatTok{0.5}\NormalTok{)) }\OperatorTok{+}\StringTok{ }
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{title =} \StringTok{"N live households per day for all loaded grid spy data"}\NormalTok{,}
       \DataTypeTok{caption =} \KeywordTok{paste0}\NormalTok{(myCaption,}
                        \StringTok{"}\CharTok{\textbackslash{}n}\StringTok{Only files of size > "}\NormalTok{, dataThreshold, }\StringTok{" bytes loaded"}\NormalTok{)}
       
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\includegraphics{processNZGGElecCons1minData_files/figure-html/liveDataHouseholds-1.png}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ggplot2}\OperatorTok{::}\KeywordTok{ggsave}\NormalTok{(}\KeywordTok{paste0}\NormalTok{(outPath, }\StringTok{"gridSpyLiveHouseholdsToDate.png"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Saving 7 x 5 in image
\end{verbatim}

\section{Runtime}\label{runtime}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{t <-}\StringTok{ }\KeywordTok{proc.time}\NormalTok{() }\OperatorTok{-}\StringTok{ }\NormalTok{startTime}

\NormalTok{elapsed <-}\StringTok{ }\NormalTok{t[[}\DecValTok{3}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

Analysis completed in 1.0424317\times 10\^{}\{4\} seconds ( 173.74
minutes) using \href{https://cran.r-project.org/package=knitr}{knitr} in
\href{http://www.rstudio.com}{RStudio} with R version 3.4.4 (2018-03-15)
running on x86\_64-apple-darwin15.6.0.

\section{R environment}\label{r-environment}

R packages used: data.table, lubridate, ggplot2, readr, dplyr, knitr

\begin{itemize}
\tightlist
\item
  base R - for the basics (R Core Team 2016)
\item
  data.table - for fast (big) data handling (Dowle et al. 2015)
\item
  lubridate - date manipulation (Grolemund and Wickham 2011)
\item
  ggplot2 - for slick graphics (Wickham 2009)
\item
  readr - for csv reading/writing (Wickham, Hester, and Francois 2016)
\item
  dplyr - for select and contains (Wickham and Francois 2016)
\item
  knitr - to create this document (Xie 2016)
\item
  greenGridr - for local NZ GREEN Grid utilities
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{sessionInfo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 3.4.4 (2018-03-15)
## Platform: x86_64-apple-darwin15.6.0 (64-bit)
## Running under: macOS High Sierra 10.13.4
## 
## Matrix products: default
## BLAS: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRblas.0.dylib
## LAPACK: /Library/Frameworks/R.framework/Versions/3.4/Resources/lib/libRlapack.dylib
## 
## locale:
## [1] en_GB.UTF-8/en_GB.UTF-8/en_GB.UTF-8/C/en_GB.UTF-8/en_GB.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] knitr_1.20          dplyr_0.7.4         readr_1.1.1        
## [4] ggplot2_2.2.1       lubridate_1.7.4     data.table_1.10.4-3
## [7] greenGridr_0.1.0   
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.16      bindr_0.1.1       magrittr_1.5     
##  [4] hms_0.4.2         munsell_0.4.3     colorspace_1.3-2 
##  [7] R6_2.2.2          rlang_0.2.0.9001  highr_0.6        
## [10] stringr_1.3.0     plyr_1.8.4        tools_3.4.4      
## [13] grid_3.4.4        gtable_0.2.0      htmltools_0.3.6  
## [16] assertthat_0.2.0  yaml_2.1.18       lazyeval_0.2.1   
## [19] rprojroot_1.3-2   digest_0.6.15     tibble_1.4.2     
## [22] bindrcpp_0.2.2    glue_1.2.0        evaluate_0.10.1  
## [25] rmarkdown_1.9     labeling_0.3      stringi_1.1.7    
## [28] compiler_3.4.4    pillar_1.2.2      scales_0.5.0.9000
## [31] backports_1.1.2   pkgconfig_2.0.1
\end{verbatim}

\hypertarget{refs}{}
\hypertarget{ref-data.table}{}
Dowle, M, A Srinivasan, T Short, S Lianoglou with contributions from R
Saporta, and E Antonyan. 2015. \emph{Data.table: Extension of
Data.frame}. \url{https://CRAN.R-project.org/package=data.table}.

\hypertarget{ref-lubridate}{}
Grolemund, Garrett, and Hadley Wickham. 2011. ``Dates and Times Made
Easy with lubridate.'' \emph{Journal of Statistical Software} 40 (3):
1--25. \url{http://www.jstatsoft.org/v40/i03/}.

\hypertarget{ref-baseR}{}
R Core Team. 2016. \emph{R: A Language and Environment for Statistical
Computing}. Vienna, Austria: R Foundation for Statistical Computing.
\url{https://www.R-project.org/}.

\hypertarget{ref-ggplot2}{}
Wickham, Hadley. 2009. \emph{Ggplot2: Elegant Graphics for Data
Analysis}. Springer-Verlag New York. \url{http://ggplot2.org}.

\hypertarget{ref-dplyr}{}
Wickham, Hadley, and Romain Francois. 2016. \emph{Dplyr: A Grammar of
Data Manipulation}. \url{https://CRAN.R-project.org/package=dplyr}.

\hypertarget{ref-readr}{}
Wickham, Hadley, Jim Hester, and Romain Francois. 2016. \emph{Readr:
Read Tabular Data}. \url{https://CRAN.R-project.org/package=readr}.

\hypertarget{ref-knitr}{}
Xie, Yihui. 2016. \emph{Knitr: A General-Purpose Package for Dynamic
Report Generation in R}. \url{https://CRAN.R-project.org/package=knitr}.


\end{document}
